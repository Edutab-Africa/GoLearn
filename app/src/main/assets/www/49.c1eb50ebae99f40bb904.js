(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"5y8i":function(e,o,r){"use strict";r.r(o),r.d(o,"AddonModForumSearchLazyModule",(function(){return w}));var c=r("L3Fv"),a=r("mrSG"),t=r("ZCW2"),n=r("FYaz"),s=r("vnm2"),d=r("ULAo"),i=r("7otd"),l=r("9CLO"),u=r("D7J2"),h=r("pHTc"),_=r("9+EE"),m=r("3LXp"),g=r("mvS9"),p=r("bFG1"),f=r("j3ag"),M=r("fXoL"),S=r("TEn/"),y=r("ofXK"),F=r("nt/U"),b=r("9zps"),A=r("xpMl"),P=r("3CSS"),v=r("hMzs"),E=r("pz8D"),x=r("r8G5"),I=r("sYmb");function AddonModForumSearchPage_h1_6_Template(e,o){if(1&e&&(M.Ec(0,"h1"),M.pd(1),M.Dc()),2&e){const e=M.Oc();M.lc(1),M.qd(e.forum.name)}}function AddonModForumSearchPage_h1_7_Template(e,o){1&e&&(M.Ec(0,"h1"),M.pd(1),M.Pc(2,"translate"),M.Dc()),2&e&&(M.lc(1),M.qd(M.Qc(2,1,"addon.block_searchforums.pluginname")))}function AddonModForumSearchPage_ion_card_10_Template(e,o){if(1&e&&(M.Ec(0,"ion-card",8),M.Ec(1,"ion-item"),M.zc(2,"ion-icon",9),M.Ec(3,"ion-label"),M.zc(4,"core-format-text",1),M.Dc(),M.Dc(),M.Dc()),2&e){const e=M.Oc();M.lc(4),M.Vc("text",e.searchBanner)}}function AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template(e,o){if(1&e){const e=M.Fc();M.Ec(0,"core-search-global-search-result",11),M.Mc("onClick",(function AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template_core_search_global_search_result_onClick_0_listener(){M.fd(e);const r=o.$implicit;return M.Oc(2).visitResult(r)})),M.Dc()}if(2&e){M.Vc("result",o.$implicit)("showCourse",!1)}}function AddonModForumSearchPage_ion_list_14_Template(e,o){if(1&e&&(M.Ec(0,"ion-list"),M.nd(1,AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template,1,2,"core-search-global-search-result",10),M.Dc()),2&e){const e=M.Oc();M.lc(1),M.Vc("ngForOf",e.resultsSource.getItems())}}function AddonModForumSearchPage_core_empty_box_16_p_1_Template(e,o){1&e&&(M.Ec(0,"p"),M.pd(1),M.Pc(2,"translate"),M.Dc()),2&e&&(M.lc(1),M.qd(M.Qc(2,1,"core.search.empty")))}const _c0=function(e){return{$a:e}};function AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template(e,o){if(1&e&&(M.Cc(0),M.Ec(1,"p"),M.Ec(2,"strong"),M.pd(3),M.Pc(4,"translate"),M.Dc(),M.Dc(),M.Ec(5,"p"),M.Ec(6,"small"),M.pd(7),M.Pc(8,"translate"),M.Dc(),M.Dc(),M.Bc()),2&e){const e=M.Oc(2);M.lc(3),M.qd(M.Rc(4,2,"core.search.noresults",M.ad(7,_c0,e.resultsSource.getQuery()))),M.lc(4),M.qd(M.Qc(8,5,"core.search.noresultshelp"))}}function AddonModForumSearchPage_core_empty_box_16_Template(e,o){if(1&e&&(M.Ec(0,"core-empty-box",12),M.nd(1,AddonModForumSearchPage_core_empty_box_16_p_1_Template,3,3,"p",2),M.nd(2,AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template,9,9,"ng-container",2),M.Dc()),2&e){const e=M.Oc();M.Vc("dimmed",!e.resultsSource.isLoaded()),M.lc(1),M.Vc("ngIf",!e.resultsSource.isLoaded()),M.lc(1),M.Vc("ngIf",e.resultsSource.isLoaded())}}let T=(()=>{class AddonModForumSearchPage{constructor(){this.loadMoreError=null,this.searchBanner=null,this.resultsSource=new i.a("",{}),this.ready=new n.a}ngOnInit(){var e,o,r,c;return Object(a.a)(this,void 0,void 0,(function*(){try{const a=_.c.getRequiredCurrentSite(),n=null!==(r=null===(o=null===(e=a.config)||void 0===e?void 0:e.searchbanner)||void 0===o?void 0:o.trim())&&void 0!==r?r:"",s=h.a.getRequiredRouteNumberParam("courseId"),i=h.a.getRouteNumberParam("forumId"),l={courseIds:[s]};if(p.a.isTrueOrOne(null===(c=a.config)||void 0===c?void 0:c.searchbannerenable)&&n.length>0&&(this.searchBanner=n),i){this.forum=yield t.a.getForumById(s,i);const e=yield d.a.getModule(this.forum.cmid,s);l.searchAreaIds=["mod_forum-post"],e.contextid&&(l.contextIds=[e.contextid]),this.searchAreaId=`AddonModForumSearch-${s}-${this.forum.id}`}else l.searchAreaIds=["mod_forum-activity","mod_forum-post"],this.searchAreaId=`AddonModForumSearch-${s}`;this.resultsSource.setFilters(l),this.ready.resolve()}catch(e){return m.a.showErrorModal(e),h.a.back(),void 0}}))}search(e){return Object(a.a)(this,void 0,void 0,(function*(){yield this.ready,this.resultsSource.setQuery(e),this.resultsSource.hasEmptyQuery()||(yield m.a.showOperationModals("core.searching",!0,(()=>Object(a.a)(this,void 0,void 0,(function*(){yield this.resultsSource.reload(),yield p.a.ignoreErrors(l.c.logViewResults(this.resultsSource.getQuery(),this.resultsSource.getFilters())),u.a.logEvent({type:u.b.VIEW_ITEM_LIST,ws:"core_search_view_results",name:f.I.instant("core.search.globalsearch"),data:{query:e,filters:JSON.stringify(this.resultsSource.getFilters())},url:g.a.addParamsToUrl("/search/index.php",{q:e})})})))))}))}clearSearch(){this.loadMoreError=null,this.resultsSource.setQuery(""),this.resultsSource.reset()}visitResult(e){return Object(a.a)(this,void 0,void 0,(function*(){yield s.a.handleLink(e.url)}))}loadMoreResults(e){var o;return Object(a.a)(this,void 0,void 0,(function*(){try{yield null===(o=this.resultsSource)||void 0===o?void 0:o.load()}catch(e){this.loadMoreError=m.a.getErrorMessage(e)}finally{e()}}))}}return AddonModForumSearchPage.ɵfac=function AddonModForumSearchPage_Factory(e){return new(e||AddonModForumSearchPage)},AddonModForumSearchPage.ɵcmp=M.sc({type:AddonModForumSearchPage,selectors:[["page-addon-mod-forum-search"]],decls:17,vars:18,consts:[["slot","start"],[3,"text"],[4,"ngIf"],[1,"limited-width"],["class","core-danger-card",4,"ngIf"],[3,"placeholder","searchLabel","autoFocus","searchArea","onSubmit","onClear"],[3,"enabled","error","action"],["icon","fas-magnifying-glass",3,"dimmed",4,"ngIf"],[1,"core-danger-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"result","showCourse","onClick",4,"ngFor","ngForOf"],[3,"result","showCourse","onClick"],["icon","fas-magnifying-glass",3,"dimmed"]],template:function AddonModForumSearchPage_Template(e,o){1&e&&(M.Ec(0,"ion-header"),M.Ec(1,"ion-toolbar"),M.Ec(2,"ion-buttons",0),M.zc(3,"ion-back-button",1),M.Pc(4,"translate"),M.Dc(),M.Ec(5,"ion-title"),M.nd(6,AddonModForumSearchPage_h1_6_Template,2,1,"h1",2),M.nd(7,AddonModForumSearchPage_h1_7_Template,3,3,"h1",2),M.Dc(),M.Dc(),M.Dc(),M.Ec(8,"ion-content",3),M.Ec(9,"div"),M.nd(10,AddonModForumSearchPage_ion_card_10_Template,5,1,"ion-card",4),M.Ec(11,"core-search-box",5),M.Mc("onSubmit",(function AddonModForumSearchPage_Template_core_search_box_onSubmit_11_listener(e){return o.search(e)}))("onClear",(function AddonModForumSearchPage_Template_core_search_box_onClear_11_listener(){return o.clearSearch()})),M.Pc(12,"translate"),M.Pc(13,"translate"),M.Dc(),M.nd(14,AddonModForumSearchPage_ion_list_14_Template,2,1,"ion-list",2),M.Ec(15,"core-infinite-loading",6),M.Mc("action",(function AddonModForumSearchPage_Template_core_infinite_loading_action_15_listener(e){return o.loadMoreResults(e)})),M.Dc(),M.nd(16,AddonModForumSearchPage_core_empty_box_16_Template,3,3,"core-empty-box",7),M.Dc(),M.Dc()),2&e&&(M.lc(3),M.Vc("text",M.Qc(4,12,"core.back")),M.lc(3),M.Vc("ngIf",o.forum),M.lc(1),M.Vc("ngIf",!o.forum),M.lc(3),M.Vc("ngIf",o.searchBanner),M.lc(1),M.Vc("placeholder",M.Qc(12,14,"core.search"))("searchLabel",M.Qc(13,16,"core.search"))("autoFocus",!0)("searchArea",o.searchAreaId),M.lc(3),M.Vc("ngIf",o.resultsSource.isLoaded()),M.lc(1),M.Vc("enabled",o.resultsSource.isLoaded()&&!o.resultsSource.isCompleted())("error",o.loadMoreError),M.lc(1),M.Vc("ngIf",o.resultsSource.isEmpty()))},directives:[S.C,S.Ab,S.m,S.h,S.i,S.yb,y.t,F.a,S.v,b.a,A.a,S.n,S.I,S.D,P.a,S.O,v.a,S.P,y.s,E.a,x.a],pipes:[I.d],styles:["[_nghost-%COMP%]{--results-count-text-color:var(--gray-700)}[_nghost-%COMP%]   .results-count[_ngcontent-%COMP%]{color:var(--results-count-text-color);min-height:0;margin:8px 16px;font-size:14px}html.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%]{--results-count-text-color:var(--gray-400)}"]}),AddonModForumSearchPage})();var O=r("tyNb"),D=r("dQ3M"),C=r("PM4H");const L=[{path:"",component:T}];let w=(()=>{class AddonModForumSearchLazyModule{}return AddonModForumSearchLazyModule.ɵmod=M.wc({type:AddonModForumSearchLazyModule}),AddonModForumSearchLazyModule.ɵinj=M.vc({factory:function AddonModForumSearchLazyModule_Factory(e){return new(e||AddonModForumSearchLazyModule)},imports:[[O.m.forChild(L),c.a,C.a,D.a]]}),AddonModForumSearchLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&M.kd(w,{declarations:[T],imports:[O.m,c.a,C.a,D.a]}))}}]);