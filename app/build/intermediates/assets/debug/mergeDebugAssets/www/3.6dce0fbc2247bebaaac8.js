(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+4NR":function(t,i,s){"use strict";s.r(i),s.d(i,"AddonModForumDiscussionLazyModule",(function(){return ci}));var o=s("tyNb"),n=s("AzLI"),e=s("MLi9"),c=s("L3Fv"),r=s("mrSG"),a=s("BaYo"),d=s("baaQ"),u=s("hSQQ"),l=s("FLKP"),m=s("y+FG"),h=s("R+GZ"),f=s("4pns"),_=s("TEn/"),g=s("GGba"),I=s("pHTc"),p=s("Y+03"),P=s("9+EE"),v=s("3LXp"),D=s("bFG1"),b=s("j3ag"),y=s("Wsfw"),A=s("6s78"),M=s("fjkH"),O=s("LVzu"),F=s("nFEd"),S=s("ZCW2"),E=s("VF9H"),T=s("h709"),C=s("pET4"),w=s("D7J2"),x=s("fXoL"),N=s("46ml");function AddonModForumDiscussionPage_h1_6_Template(t,i){if(1&t&&(x.Ec(0,"h1"),x.zc(1,"core-format-text",23),x.Dc()),2&t){const t=x.Oc();x.lc(1),x.Vc("text",t.startingPost.subject)("contextInstanceId",t.cmId)("courseId",t.courseId)}}function AddonModForumDiscussionPage_core_context_menu_item_10_Template(t,i){if(1&t){const t=x.Fc();x.Ec(0,"core-context-menu-item",24),x.Mc("action",(function AddonModForumDiscussionPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(i){x.fd(t);return x.Oc().doRefresh(null,i)})),x.Pc(1,"translate"),x.Dc()}if(2&t){const t=x.Oc();x.Vc("priority",650)("content",x.Qc(1,4,"addon.mod_forum.refreshposts"))("iconAction",t.refreshIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_core_context_menu_item_11_Template(t,i){if(1&t){const t=x.Fc();x.Ec(0,"core-context-menu-item",24),x.Mc("action",(function AddonModForumDiscussionPage_core_context_menu_item_11_Template_core_context_menu_item_action_0_listener(i){x.fd(t);return x.Oc().doRefresh(null,i,!0)})),x.Pc(1,"translate"),x.Dc()}if(2&t){const t=x.Oc();x.Vc("priority",550)("content",x.Qc(1,4,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1)}}const _c0=function(t){return{$a:t}};function AddonModForumDiscussionPage_ion_card_37_Template(t,i){if(1&t&&(x.Ec(0,"ion-card",25),x.Ec(1,"ion-item"),x.zc(2,"ion-icon",26),x.Ec(3,"ion-label"),x.pd(4),x.Pc(5,"translate"),x.Dc(),x.Dc(),x.Dc()),2&t){const t=x.Oc();x.lc(4),x.qd(x.Rc(5,1,"core.hasdatatosync",x.ad(4,_c0,t.discussionStr)))}}function AddonModForumDiscussionPage_ion_card_38_Template(t,i){if(1&t&&(x.Ec(0,"ion-card",27),x.Ec(1,"ion-item"),x.zc(2,"ion-icon",28),x.Ec(3,"ion-label"),x.pd(4),x.Dc(),x.Dc(),x.Dc()),2&t){const t=x.Oc();x.lc(4),x.qd(t.availabilityMessage)}}function AddonModForumDiscussionPage_ion_card_39_Template(t,i){1&t&&(x.Ec(0,"ion-card",27),x.Ec(1,"ion-item"),x.zc(2,"ion-icon",29),x.Ec(3,"ion-label"),x.pd(4),x.Pc(5,"translate"),x.Dc(),x.Dc(),x.Dc()),2&t&&(x.lc(4),x.qd(x.Qc(5,1,"addon.mod_forum.discussionlocked")))}function AddonModForumDiscussionPage_ion_card_40_Template(t,i){1&t&&(x.Ec(0,"ion-card",27),x.Ec(1,"ion-item"),x.zc(2,"ion-icon",28),x.Ec(3,"ion-label"),x.pd(4),x.Pc(5,"translate"),x.Dc(),x.Dc(),x.Dc()),2&t&&(x.lc(4),x.qd(x.Qc(5,1,"addon.mod_forum.qandanotify")))}function AddonModForumDiscussionPage_div_41_Template(t,i){if(1&t){const t=x.Fc();x.Ec(0,"div",30),x.Ec(1,"addon-mod-forum-post",31),x.Mc("onPostChange",(function AddonModForumDiscussionPage_div_41_Template_addon_mod_forum_post_onPostChange_1_listener(){x.fd(t);return x.Oc().postListChanged()})),x.Dc(),x.Dc()}if(2&t){const t=x.Oc();x.lc(1),x.Vc("post",t.startingPost)("discussion",t.discussion)("courseId",t.courseId)("highlight",!0)("discussionId",t.discussionId)("component",t.component)("componentId",t.cmId)("formData",t.formData)("originalData",t.originalData)("forum",t.forum)("accessInfo",t.accessInfo)("trackPosts",t.trackPosts)("ratingInfo",t.ratingInfo)("leavingPage",t.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template(t,i){1&t&&x.zc(0,"core-spacer")}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template(t,i){if(1&t){const t=x.Fc();x.Cc(0),x.nd(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template,1,0,"core-spacer",2),x.Ec(2,"addon-mod-forum-post",33),x.Mc("onPostChange",(function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template_addon_mod_forum_post_onPostChange_2_listener(){x.fd(t);return x.Oc(2).postListChanged()})),x.Dc(),x.Bc()}if(2&t){const t=i.$implicit,s=i.first,o=x.Oc(2);x.lc(1),x.Vc("ngIf",!s),x.lc(1),x.Vc("post",t)("courseId",o.courseId)("discussionId",o.discussionId)("component",o.component)("componentId",o.cmId)("formData",o.formData)("originalData",o.originalData)("parentSubject",o.postSubjects[t.parentid])("forum",o.forum)("accessInfo",o.accessInfo)("trackPosts",o.trackPosts)("ratingInfo",o.ratingInfo)("leavingPage",o.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_Template(t,i){if(1&t&&(x.Ec(0,"ion-card"),x.nd(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template,3,14,"ng-container",32),x.Dc()),2&t){const t=x.Oc();x.lc(1),x.Vc("ngForOf",t.posts)}}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template(t,i){1&t&&x.Ac(0)}const _c1=function(t){return{post:t}};function AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template(t,i){if(1&t&&(x.Cc(0),x.nd(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),x.Bc()),2&t){const t=i.$implicit;x.Oc(2);const s=x.ed(45);x.lc(1),x.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",x.ad(2,_c1,t))}}function AddonModForumDiscussionPage_ng_container_43_Template(t,i){if(1&t&&(x.Cc(0),x.nd(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template,2,4,"ng-container",32),x.Bc()),2&t){const t=x.Oc();x.lc(1),x.Vc("ngForOf",t.posts)}}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template(t,i){1&t&&x.Ac(0)}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template(t,i){if(1&t&&(x.Cc(0),x.nd(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),x.Bc()),2&t){const t=i.$implicit;x.Oc(3);const s=x.ed(45);x.lc(1),x.Vc("ngTemplateOutlet",s)("ngTemplateOutletContext",x.ad(2,_c1,t))}}function AddonModForumDiscussionPage_ng_template_44_div_2_Template(t,i){if(1&t&&(x.Ec(0,"div",36),x.nd(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template,2,4,"ng-container",32),x.Dc()),2&t){const t=x.Oc().post;x.lc(1),x.Vc("ngForOf",t.children)}}function AddonModForumDiscussionPage_ng_template_44_Template(t,i){if(1&t){const t=x.Fc();x.Ec(0,"ion-card"),x.Ec(1,"addon-mod-forum-post",33),x.Mc("onPostChange",(function AddonModForumDiscussionPage_ng_template_44_Template_addon_mod_forum_post_onPostChange_1_listener(){x.fd(t);return x.Oc().postListChanged()})),x.Dc(),x.Dc(),x.nd(2,AddonModForumDiscussionPage_ng_template_44_div_2_Template,2,1,"div",35)}if(2&t){const t=i.post,s=x.Oc();x.lc(1),x.Vc("post",t)("courseId",s.courseId)("discussionId",s.discussionId)("component",s.component)("componentId",s.cmId)("formData",s.formData)("originalData",s.originalData)("parentSubject",s.postSubjects[t.parentid])("forum",s.forum)("accessInfo",s.accessInfo)("trackPosts",s.trackPosts)("ratingInfo",s.ratingInfo)("leavingPage",s.leavingPage),x.lc(1),x.Vc("ngIf",t.children&&t.children.length&&t.children[0].subject)}}let k=(()=>{class AddonModForumDiscussionPage{constructor(t,i,s){this.splitView=t,this.elementRef=i,this.route=s,this.forum={},this.accessInfo={},this.posts=[],this.discussionLoaded=!1,this.sort="nested",this.formData={replyingTo:0,isEditing:!1,subject:"",message:null,files:[],isprivatereply:!1},this.originalData={subject:null,message:null,files:[],isprivatereply:!1},this.refreshIcon=a.a.ICON_LOADING,this.syncIcon=a.a.ICON_LOADING,this.discussionStr="",this.component=S.b.COMPONENT,this.canPin=!1,this.availabilityMessage=null,this.showQAMessage=!1,this.leavingPage=!1,this.hasOfflineRatings=!1}get isMobile(){return p.a.isMobile}ngOnInit(){var t,i,s;return Object(r.a)(this,void 0,void 0,(function*(){try{const s=this.route.snapshot.data;this.courseId=I.a.getRouteNumberParam("courseId"),this.cmId=I.a.getRouteNumberParam("cmId"),this.forumId=I.a.getRouteNumberParam("forumId"),this.discussion=I.a.getRouteParam("discussion"),this.discussionId=this.discussion?this.discussion.discussion:I.a.getRequiredRouteNumberParam("discussionId"),this.trackPosts=I.a.getRouteBooleanParam("trackPosts")||!1,this.postId=I.a.getRouteNumberParam("postId"),this.parent=I.a.getRouteNumberParam("parent"),this.courseId&&this.cmId&&(null===(t=s.swipeEnabled)||void 0===t||t)&&(this.discussions=new discussion_AddonModForumDiscussionDiscussionsSwipeManager(d.a.getOrCreateSource(O.a,[this.courseId,this.cmId,null!==(i=s.discussionsPathPrefix)&&void 0!==i?i:""])),yield this.discussions.start())}catch(t){return v.a.showErrorModal(t),this.goBack(),void 0}this.isOnline=g.a.isOnline(),this.externalUrl=null===(s=P.c.getCurrentSite())||void 0===s?void 0:s.createSiteUrl("/mod/forum/discuss.php",{d:this.discussionId.toString()}),this.onlineObserver=g.a.onChange().subscribe((()=>{b.z.run((()=>{this.isOnline=g.a.isOnline()}))})),this.discussionStr=b.I.instant("addon.mod_forum.discussion")}))}ngAfterViewInit(){return Object(r.a)(this,void 0,void 0,(function*(){this.sort=this.parent?"nested":yield this.getUserSort(),yield this.fetchPosts(!0,!1,!0);const t=this.postId||this.parent;t&&A.a.scrollToElement(this.elementRef.nativeElement,"#addon-mod_forum-post-"+t)}))}ionViewDidEnter(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.syncObserver)return;this.discussion||(yield this.loadDiscussion(this.discussionId,this.forumId,this.cmId));const t=this.discussion;this.syncObserver=M.b.on(C.b.AUTO_SYNCED,(t=>{t.forumId==this.forumId&&this.discussionId==t.discussionId&&t.userId==P.c.getCurrentSiteUserId()&&(this.discussionLoaded=!1,this.refreshPosts())}),P.c.getCurrentSiteId()),this.syncManualObserver=M.b.on(C.b.MANUAL_SYNCED,(t=>{"discussion"!=t.source&&t.forumId==this.forumId&&t.userId==P.c.getCurrentSiteUserId()&&(this.discussionLoaded=!1,this.refreshPosts())}),P.c.getCurrentSiteId()),this.forumId&&t&&t.numunread>0&&S.a.invalidateDiscussionsList(this.forumId),this.ratingOfflineObserver=M.b.on(l.b.RATING_SAVED_EVENT,(t=>{"mod_forum"==t.component&&"post"==t.ratingArea&&"module"==t.contextLevel&&t.instanceId==this.cmId&&t.itemSetId==this.discussionId&&(this.hasOfflineRatings=!0)})),this.ratingSyncObserver=M.b.on(h.b.SYNCED_EVENT,(t=>Object(r.a)(this,void 0,void 0,(function*(){"mod_forum"==t.component&&"post"==t.ratingArea&&"module"==t.contextLevel&&t.instanceId==this.cmId&&t.itemSetId==this.discussionId&&(this.hasOfflineRatings=!1)})))),this.changeDiscObserver=M.b.on(S.b.CHANGE_DISCUSSION_EVENT,(i=>{t&&this.forumId&&(this.forumId===i.forumId||i.cmId===this.cmId)&&S.a.invalidateDiscussionsList(this.forumId).finally((()=>{var s;void 0!==i.locked&&(t.locked=i.locked),void 0!==i.pinned&&(t.pinned=i.pinned),void 0!==i.starred&&(t.starred=i.starred),void 0!==i.deleted&&i.deleted&&((null===(s=i.post)||void 0===s?void 0:s.parentid)?(this.discussionLoaded=!1,this.refreshPosts()):this.goBack())}))}))}))}canLeave(){return Object(r.a)(this,void 0,void 0,(function*(){return E.a.hasPostDataChanged(this.formData,this.originalData)&&(yield v.a.showConfirm(b.I.instant("core.confirmcanceledit"))),u.a.clearTmpFiles(this.formData.files),this.leavingPage=!0,!0}))}goBack(){var t;this.leavingPage||((null===(t=this.splitView)||void 0===t?void 0:t.outletActivated)?I.a.navigate("../"):I.a.back())}ionViewWillLeave(){this.syncObserver&&this.syncObserver.off(),this.syncManualObserver&&this.syncManualObserver.off(),this.ratingOfflineObserver&&this.ratingOfflineObserver.off(),this.ratingSyncObserver&&this.ratingSyncObserver.off(),this.changeDiscObserver&&this.changeDiscObserver.off(),delete this.syncObserver}ngOnDestroy(){this.onlineObserver&&this.onlineObserver.unsubscribe(),this.discussions&&this.discussions.destroy()}getUserSort(){return Object(r.a)(this,void 0,void 0,(function*(){try{return yield P.c.getRequiredCurrentSite().getLocalSiteConfig("AddonModForumDiscussionSort")}catch(t){try{const t=yield f.a.getUserPreference("forum_displaymode");switch(Number(t)){case 1:return"flat-oldest";case-1:return"flat-newest";case 3:return"nested"}}catch(t){}}return"flat-oldest"}))}fetchForum(){if(this.courseId&&this.cmId)return S.a.getForum(this.courseId,this.cmId);if(this.courseId&&this.forumId)return S.a.getForumById(this.courseId,this.forumId);throw new Error("Cannot get the forum")}fetchPosts(t,i,s){return Object(r.a)(this,void 0,void 0,(function*(){let o=[];const n=[];let e=!1;try{t&&(yield D.a.ignoreErrors(this.syncDiscussion(!!i)));const s=yield S.a.getDiscussionPosts(this.discussionId,{cmId:this.cmId}),c=yield T.a.getDiscussionReplies(this.discussionId);this.ratingInfo=s.ratinginfo,o=s.posts,this.courseId=s.courseid||this.courseId,this.forumId=s.forumid||this.forumId,this.postHasOffline=!!c.length;const a=[],d={};o.forEach((t=>{d[t.id]=t,e=e||!!t.unread})),c.forEach((t=>{this.forumId||(this.forumId=t.forumid),this.courseId||(this.courseId=t.courseid),a.push(E.a.instance.convertOfflineReplyToOnline(t).then((t=>Object(r.a)(this,void 0,void 0,(function*(){n.push(t),t.parentid&&(d[t.parentid].capabilities.reply=!1)})))))})),yield Promise.all(a),o=D.a.objectToArray(d);let u=n.concat(o);if(this.startingPost=S.a.extractStartingPost(u),"nested"==this.sort){S.a.sortDiscussionPosts(u,"ASC");u=D.a.formatTree(u,"parentid","id",this.startingPost?this.startingPost.id:this.discussion?this.discussion.id:0)}else{S.a.sortDiscussionPosts(u,"flat-newest"==this.sort?"DESC":"ASC")}try{const t=yield this.fetchForum();void 0!==t.istracked&&(this.trackPosts=t.istracked),this.forumId=t.id,this.cmId=t.cmid,this.courseId=t.course,this.forum=t,this.availabilityMessage=E.a.getAvailabilityMessage(t);const i=[];i.push(S.a.instance.getAccessInformation(this.forumId,{cmId:this.cmId}).then((i=>Object(r.a)(this,void 0,void 0,(function*(){this.accessInfo=i,E.a.isCutoffDateReached(t)&&!i.cancanoverridecutoff&&u.forEach((t=>{t.capabilities.reply=!1}));const s=P.c.getCurrentSiteUserId();this.showQAMessage="qanda"===t.type&&!i.canviewqandawithoutposting&&!u.some((t=>t.author.id===s))}))))),this.discussion||i.push(this.loadDiscussion(this.discussionId,this.forumId,this.cmId)),yield Promise.all(i)}catch(t){}if(!this.discussion&&!this.startingPost)throw new Error("Invalid forum discussion.");if(this.startingPost&&this.startingPost.author&&"single"==this.forum.type&&(delete this.startingPost.author.fullname,delete this.startingPost.author.groups),this.posts=u,this.postSubjects=this.getAllPosts().reduce(((t,i)=>(t[i.id]=i.subject,t)),this.startingPost?{[this.startingPost.id]:this.startingPost.subject}:{}),S.a.isSetPinStateAvailableForSite()&&this.forumId)try{const t=yield S.a.canAddDiscussionToAll(this.forumId,{cmId:this.cmId});this.canPin=!!t.canpindiscussions}catch(t){this.canPin=!1}else this.canPin=!1;this.hasOfflineRatings=yield m.a.hasRatings("mod_forum","post","module",this.cmId,this.discussionId)}catch(t){v.a.showErrorModal(t)}finally{this.discussionLoaded=!0,this.refreshIcon=a.a.ICON_REFRESH,this.syncIcon=a.a.ICON_SYNC,(s||e&&this.trackPosts)&&this.logDiscussionView(s)}}))}loadDiscussion(t,i,s){return Object(r.a)(this,void 0,void 0,(function*(){!this.discussion&&i&&s&&(this.discussion=yield E.a.getDiscussionById(i,s,t),this.discussionId=this.discussion.discussion)}))}syncDiscussion(t){return Object(r.a)(this,void 0,void 0,(function*(){const i=[];i.push(C.a.instance.syncDiscussionReplies(this.discussionId).then((t=>{t.warnings&&t.warnings.length&&v.a.showAlert(void 0,t.warnings[0]),t&&t.updated&&this.forumId&&M.b.trigger(C.b.MANUAL_SYNCED,{forumId:this.forumId,userId:P.c.getCurrentSiteUserId(),source:"discussion"},P.c.getCurrentSiteId())}))),i.push(C.a.instance.syncRatings(this.cmId,this.discussionId).then((t=>{t.warnings&&t.warnings.length&&v.a.showAlert(void 0,t.warnings[0])})));try{yield Promise.all(i)}catch(i){throw t&&v.a.showErrorModalDefault(i,"core.errorsync",!0),new Error("Failed syncing discussion")}}))}doRefresh(t,i,s=!1){return Object(r.a)(this,void 0,void 0,(function*(){this.discussionLoaded&&(yield this.refreshPosts(!0,s).finally((()=>{null==t?void 0:t.complete(),i&&i()})))}))}refreshPosts(t,i){return Object(r.a)(this,void 0,void 0,(function*(){this.content.scrollToTop(),this.refreshIcon=a.a.ICON_LOADING,this.syncIcon=a.a.ICON_LOADING;const s=[];this.courseId&&s.push(S.a.invalidateForumData(this.courseId)),s.push(S.a.invalidateDiscussionPosts(this.discussionId,this.forumId)),this.forumId&&s.push(S.a.invalidateAccessInformation(this.forumId)),this.forumId&&s.push(S.a.invalidateCanAddDiscussion(this.forumId)),yield D.a.ignoreErrors(D.a.allPromises(s)),yield this.fetchPosts(t,i)}))}changeSort(t){return this.discussionLoaded=!1,this.sort=t,P.c.getRequiredCurrentSite().setLocalSiteConfig("AddonModForumDiscussionSort",this.sort),this.content.scrollToTop(),this.fetchPosts()}setLockState(t){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.discussion||!this.forumId||!this.cmId)return;const i=yield v.a.showModalLoading("core.sending",!0);try{const i=yield S.a.setLockState(this.forumId,this.discussionId,t);this.discussion.locked=i.locked;M.b.trigger(S.b.CHANGE_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId,locked:this.discussion.locked},P.c.getCurrentSiteId()),v.a.showToast("addon.mod_forum.lockupdated",!0)}catch(t){v.a.showErrorModal(t)}finally{i.dismiss()}}))}setPinState(t){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.discussion||!this.forumId||!this.cmId)return;const i=yield v.a.showModalLoading("core.sending",!0);try{yield S.a.setPinState(this.discussionId,t),this.discussion.pinned=t;M.b.trigger(S.b.CHANGE_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId,pinned:this.discussion.pinned},P.c.getCurrentSiteId()),v.a.showToast("addon.mod_forum.pinupdated",!0)}catch(t){v.a.showErrorModal(t)}finally{i.dismiss()}}))}toggleFavouriteState(t){return Object(r.a)(this,void 0,void 0,(function*(){if(!this.discussion||!this.forumId||!this.cmId)return;const i=yield v.a.showModalLoading("core.sending",!0);try{yield S.a.toggleFavouriteState(this.discussionId,t),this.discussion.starred=t;M.b.trigger(S.b.CHANGE_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId,starred:this.discussion.starred},P.c.getCurrentSiteId()),v.a.showToast("addon.mod_forum.favouriteupdated",!0)}catch(t){v.a.showErrorModal(t)}finally{i.dismiss()}}))}postListChanged(){if(!this.forumId||!this.cmId)return;M.b.trigger(S.b.REPLY_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId},P.c.getCurrentSiteId()),this.discussionLoaded=!1,this.refreshPosts().finally((()=>{this.discussionLoaded=!0}))}getAllPosts(){const t=this.posts.map((t=>this.flattenPostHierarchy(t)));return y.a.flatten(t)}flattenPostHierarchy(t){const i=[t],s=t.children||[];for(const t of s)i.push(...this.flattenPostHierarchy(t));return i}logDiscussionView(t=!1){var i,s,o;return Object(r.a)(this,void 0,void 0,(function*(){yield D.a.ignoreErrors(S.a.logDiscussionView(this.discussionId,this.forumId||-1)),t&&w.a.logEvent({type:w.b.VIEW_ITEM,ws:"mod_forum_view_forum_discussion",name:null!==(o=null!==(s=null===(i=this.startingPost)||void 0===i?void 0:i.subject)&&void 0!==s?s:this.forum.name)&&void 0!==o?o:"",data:{id:this.discussionId,forumid:this.forumId,category:"forum"},url:`/mod/forum/discuss.php?d=${this.discussionId}`+(this.postId?`#p${this.postId}`:"")}),this.courseId&&this.cmId&&M.b.trigger(S.b.MARK_READ_EVENT,{courseId:this.courseId,moduleId:this.cmId},P.c.getCurrentSiteId())}))}}return AddonModForumDiscussionPage.ɵfac=function AddonModForumDiscussionPage_Factory(t){return new(t||AddonModForumDiscussionPage)(x.yc(N.a,8),x.yc(x.r),x.yc(o.a))},AddonModForumDiscussionPage.ɵcmp=x.sc({type:AddonModForumDiscussionPage,selectors:[["page-addon-mod-forum-discussion"]],viewQuery:function AddonModForumDiscussionPage_Query(t,i){var s;(1&t&&x.ud(_.v,!0),2&t)&&(x.dd(s=x.Nc())&&(i.content=s.first))},decls:46,vars:73,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"priority","content","iconAction","closeOnClick","action",4,"ngIf"],["iconAction","fas-arrow-down",3,"hidden","priority","content","action"],["iconAction","fas-arrow-up",3,"hidden","priority","content","action"],["iconAction","fas-right-left",3,"hidden","priority","content","action"],["iconAction","fas-lock",3,"hidden","priority","content","action"],["iconAction","fas-unlock",3,"hidden","priority","content","action"],["iconAction","fas-map-pin",3,"hidden","priority","content","action"],["iconAction","fas-map-pin",3,"hidden","priority","content","iconSlash","action"],["iconAction","fas-star",3,"hidden","priority","content","action"],["iconAction","fas-star",3,"hidden","priority","content","iconSlash","action"],["iconAction","fas-up-right-from-square",3,"hidden","priority","content","href","showBrowserWarning"],[1,"limited-width",3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],["class","core-info-card",4,"ngIf"],["class","ion-margin-bottom",4,"ngIf"],["nestedPosts",""],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"priority","content","iconAction","closeOnClick","action"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],["name","fas-lock","slot","start","aria-hidden","true"],[1,"ion-margin-bottom"],[3,"post","discussion","courseId","highlight","discussionId","component","componentId","formData","originalData","forum","accessInfo","trackPosts","ratingInfo","leavingPage","onPostChange"],[4,"ngFor","ngForOf"],[3,"post","courseId","discussionId","component","componentId","formData","originalData","parentSubject","forum","accessInfo","trackPosts","ratingInfo","leavingPage","onPostChange"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function AddonModForumDiscussionPage_Template(t,i){1&t&&(x.Ec(0,"ion-header"),x.Ec(1,"ion-toolbar"),x.Ec(2,"ion-buttons",0),x.zc(3,"ion-back-button",1),x.Pc(4,"translate"),x.Dc(),x.Ec(5,"ion-title"),x.nd(6,AddonModForumDiscussionPage_h1_6_Template,2,3,"h1",2),x.Dc(),x.zc(7,"ion-buttons",3),x.Dc(),x.Dc(),x.Ec(8,"core-navbar-buttons",3),x.Ec(9,"core-context-menu"),x.nd(10,AddonModForumDiscussionPage_core_context_menu_item_10_Template,2,6,"core-context-menu-item",4),x.nd(11,AddonModForumDiscussionPage_core_context_menu_item_11_Template,2,6,"core-context-menu-item",4),x.Ec(12,"core-context-menu-item",5),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_12_listener(){return i.changeSort("flat-oldest")})),x.Pc(13,"translate"),x.Dc(),x.Ec(14,"core-context-menu-item",6),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_14_listener(){return i.changeSort("flat-newest")})),x.Pc(15,"translate"),x.Dc(),x.Ec(16,"core-context-menu-item",7),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_16_listener(){return i.changeSort("nested")})),x.Pc(17,"translate"),x.Dc(),x.Ec(18,"core-context-menu-item",8),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_18_listener(){return i.setLockState(!0)})),x.Pc(19,"translate"),x.Dc(),x.Ec(20,"core-context-menu-item",9),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_20_listener(){return i.setLockState(!1)})),x.Pc(21,"translate"),x.Dc(),x.Ec(22,"core-context-menu-item",10),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_22_listener(){return i.setPinState(!0)})),x.Pc(23,"translate"),x.Dc(),x.Ec(24,"core-context-menu-item",11),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_24_listener(){return i.setPinState(!1)})),x.Pc(25,"translate"),x.Dc(),x.Ec(26,"core-context-menu-item",12),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_26_listener(){return i.toggleFavouriteState(!0)})),x.Pc(27,"translate"),x.Dc(),x.Ec(28,"core-context-menu-item",13),x.Mc("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_28_listener(){return i.toggleFavouriteState(!1)})),x.Pc(29,"translate"),x.Dc(),x.zc(30,"core-context-menu-item",14),x.Pc(31,"translate"),x.Dc(),x.Dc(),x.Ec(32,"ion-content",15),x.Ec(33,"ion-refresher",16),x.Mc("ionRefresh",(function AddonModForumDiscussionPage_Template_ion_refresher_ionRefresh_33_listener(t){return i.doRefresh(t.target)})),x.zc(34,"ion-refresher-content",17),x.Pc(35,"translate"),x.Dc(),x.Ec(36,"core-loading",18),x.nd(37,AddonModForumDiscussionPage_ion_card_37_Template,6,6,"ion-card",19),x.nd(38,AddonModForumDiscussionPage_ion_card_38_Template,5,1,"ion-card",20),x.nd(39,AddonModForumDiscussionPage_ion_card_39_Template,6,3,"ion-card",20),x.nd(40,AddonModForumDiscussionPage_ion_card_40_Template,6,3,"ion-card",20),x.nd(41,AddonModForumDiscussionPage_div_41_Template,2,14,"div",21),x.nd(42,AddonModForumDiscussionPage_ion_card_42_Template,2,1,"ion-card",2),x.nd(43,AddonModForumDiscussionPage_ng_container_43_Template,2,1,"ng-container",2),x.nd(44,AddonModForumDiscussionPage_ng_template_44_Template,3,14,"ng-template",null,22,x.od),x.Dc(),x.Dc()),2&t&&(x.lc(3),x.Vc("text",x.Qc(4,49,"core.back")),x.lc(3),x.Vc("ngIf",i.startingPost),x.lc(4),x.Vc("ngIf",i.discussionLoaded&&!i.postHasOffline&&i.isOnline),x.lc(1),x.Vc("ngIf",i.discussionLoaded&&i.isMobile&&i.postHasOffline&&i.isOnline),x.lc(1),x.Vc("hidden","flat-oldest"==i.sort)("priority",500)("content",x.Qc(13,51,"addon.mod_forum.modeflatoldestfirst")),x.lc(2),x.Vc("hidden","flat-newest"==i.sort)("priority",450)("content",x.Qc(15,53,"addon.mod_forum.modeflatnewestfirst")),x.lc(2),x.Vc("hidden","nested"==i.sort)("priority",400)("content",x.Qc(17,55,"addon.mod_forum.modenested")),x.lc(2),x.Vc("hidden",!i.discussion||!i.discussion.canlock||i.discussion.locked)("priority",300)("content",x.Qc(19,57,"addon.mod_forum.lockdiscussion")),x.lc(2),x.Vc("hidden",!i.discussion||!i.discussion.canlock||!i.discussion.locked)("priority",300)("content",x.Qc(21,59,"addon.mod_forum.unlockdiscussion")),x.lc(2),x.Vc("hidden",!i.discussion||!i.canPin||i.discussion.pinned)("priority",250)("content",x.Qc(23,61,"addon.mod_forum.pindiscussion")),x.lc(2),x.Vc("hidden",!i.discussion||!i.canPin||!i.discussion.pinned)("priority",250)("content",x.Qc(25,63,"addon.mod_forum.unpindiscussion"))("iconSlash",!0),x.lc(2),x.Vc("hidden",!i.discussion||!i.discussion.canfavourite||i.discussion.starred)("priority",200)("content",x.Qc(27,65,"addon.mod_forum.addtofavourites")),x.lc(2),x.Vc("hidden",!i.discussion||!i.discussion.canfavourite||!i.discussion.starred)("priority",200)("content",x.Qc(29,67,"addon.mod_forum.removefromfavourites"))("iconSlash",!0),x.lc(2),x.Vc("hidden",!i.externalUrl)("priority",100)("content",x.Qc(31,69,"core.openinbrowser"))("href",i.externalUrl)("showBrowserWarning",!1),x.lc(2),x.Vc("core-swipe-navigation",i.discussions),x.lc(1),x.Vc("disabled",!i.discussionLoaded),x.lc(1),x.Wc("pullingText",x.Qc(35,71,"core.pulltorefresh")),x.lc(2),x.Vc("hideUntil",i.discussionLoaded),x.lc(1),x.Vc("ngIf",i.postHasOffline||i.hasOfflineRatings),x.lc(1),x.Vc("ngIf",i.availabilityMessage),x.lc(1),x.Vc("ngIf",i.discussion&&i.discussion.locked),x.lc(1),x.Vc("ngIf",i.showQAMessage),x.lc(1),x.Vc("ngIf",i.startingPost),x.lc(1),x.Vc("ngIf","nested"!=i.sort&&i.posts.length),x.lc(1),x.Vc("ngIf","nested"==i.sort&&i.posts.length))},styles:["[_nghost-%COMP%]   .addon-forum-reply-button[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin:0}"]}),AddonModForumDiscussionPage})();class discussion_AddonModForumDiscussionDiscussionsSwipeManager extends F.a{getSelectedItemPathFromRoute(t){return this.getSource().DISCUSSIONS_PATH_PREFIX+t.params.discussionId}}var L=s("ofXK"),V=s("M9y5"),j=s("aEIl"),R=s("3zv0"),z=s("Lmwl"),Q=s("4qNr"),U=s("fQ68"),B=s("8/N+"),H=s("0QZc"),G=s("g8IU"),q=s("uHIS"),J=s("w+Pn"),Y=s("r8G5"),W=s("5450"),K=s("W5pS"),$=s("WPIK"),X=s("qNqN"),Z=s("xpMl"),tt=s("FTxb"),it=s("PgjG"),st=s("/K1O"),ot=s("FasJ"),nt=s("9pYf"),et=s("eAud"),ct=s("ACV2"),rt=s("/BoF"),at=s("TKc2"),dt=s("whRm"),ut=s("O4u7"),lt=s("lqoc"),mt=s("3lz8"),ht=s("QQhE"),ft=s("MpCO"),_t=s("JYLr"),gt=s("vWwc"),It=s("NhJP"),pt=s("rztj"),Pt=s("FeAf"),vt=s("rf3J"),Dt=s("nEkO"),bt=s("TF0o"),yt=s("p5uK"),At=s("ijlo"),Mt=s("vFDU"),Ot=s("6uVz"),Ft=s("d0nH"),St=s("NcPy"),Et=s("yNDK"),Tt=s("3CSS"),Ct=s("hMzs"),wt=s("iSJP"),xt=s("iJls"),Nt=s("ArDJ"),kt=s("nu3w"),Lt=s("saTE"),Vt=s("8PoL"),jt=s("4a38"),Rt=s("4JiN"),zt=s("OZH1"),Qt=s("edOc"),Ut=s("3jOR"),Bt=s("nt/U"),Ht=s("ACYt"),Gt=s("6A9T"),qt=s("3Pt+"),Jt=s("sYmb"),Yt=s("GsO6"),Wt=s("L5yw"),Kt=s("1iFe"),$t=s("dne1"),Xt=s("Cg42"),Zt=s("llyR"),ti=s("uYHD"),ii=s("SspJ"),si=s("U2xU"),oi=s("lAaw"),ni=s("1ArG");const ei=[{path:"",component:k,canDeactivate:[e.a]}];let ci=(()=>{class AddonModForumDiscussionLazyModule{}return AddonModForumDiscussionLazyModule.ɵmod=x.wc({type:AddonModForumDiscussionLazyModule}),AddonModForumDiscussionLazyModule.ɵinj=x.vc({factory:function AddonModForumDiscussionLazyModule_Factory(t){return new(t||AddonModForumDiscussionLazyModule)},imports:[[o.m.forChild(ei),c.a,n.a]]}),AddonModForumDiscussionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&x.kd(ci,{declarations:[k],imports:[o.m,c.a,n.a]})),x.jd(k,[o.n,o.j,o.l,o.k,o.p,L.q,L.r,L.s,L.t,L.A,L.w,L.x,L.y,L.z,L.u,L.v,V.a,j.a,R.a,z.a,Q.a,U.a,B.a,H.a,G.a,q.a,J.a,Y.a,W.a,K.a,$.a,X.a,Z.a,tt.a,it.a,st.a,ot.a,nt.a,et.a,ct.a,rt.a,at.a,dt.a,ut.a,lt.a,mt.a,N.a,ht.a,ft.a,_t.a,gt.a,It.a,pt.a,Pt.a,vt.a,Dt.a,bt.a,yt.a,At.a,Mt.a,Ot.a,Ft.a,St.a,Et.a,Tt.a,Ct.a,wt.a,xt.a,Nt.a,kt.a,Lt.a,Vt.a,jt.a,Rt.b,zt.a,Qt.a,Ut.a,Bt.a,Ht.a,Gt.a,qt.H,qt.w,qt.G,qt.c,qt.x,qt.A,qt.a,qt.D,qt.E,qt.z,qt.r,qt.s,qt.C,qt.o,qt.n,qt.y,qt.b,qt.d,qt.u,qt.v,qt.t,_.f,_.g,_.h,_.j,_.k,_.l,_.m,_.n,_.o,_.p,_.q,_.r,_.s,_.t,_.u,_.v,_.w,_.x,_.y,_.z,_.A,_.B,_.C,_.D,_.E,_.F,_.G,_.H,_.I,_.J,_.K,_.L,_.M,_.N,_.O,_.P,_.Q,_.R,_.S,_.T,_.U,_.V,_.W,_.X,_.Y,_.Z,_.ab,_.bb,_.cb,_.db,_.eb,_.fb,_.hb,_.ib,_.jb,_.kb,_.lb,_.mb,_.nb,_.ob,_.pb,_.qb,_.rb,_.sb,_.tb,_.vb,_.wb,_.xb,_.zb,_.Ab,_.yb,_.ub,_.d,_.Jb,_.Mb,_.Ob,_.Pb,_.gb,_.i,_.Hb,_.Nb,_.Rb,_.Sb,_.Tb,_.Bb,qt.h,qt.k,qt.i,qt.l,qt.e,Jt.a,Yt.AddonModForumIndexComponent,Wt.a,k],[L.b,L.G,L.p,L.k,L.E,L.g,L.C,L.F,L.d,L.f,L.i,L.j,L.l,Kt.a,$t.a,Xt.a,Zt.a,ti.a,ii.a,si.a,oi.a,ni.a,Jt.d])},eoiU:function(t,i,s){"use strict";s.d(i,"a",(function(){return CoreSwipeNavigationItemsManager}));var o=s("mrSG"),n=s("pHTc"),e=s("CtbY");class CoreSwipeNavigationItemsManager extends e.a{start(){return Object(o.a)(this,void 0,void 0,(function*(){this.updateSelectedItem()}))}navigateToNextItem(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(1,"forward")}))}navigateToPreviousItem(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.navigateToItemBy(-1,"back")}))}hasNextItem(){return Object(o.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(1))}))}hasPreviousItem(){return Object(o.a)(this,void 0,void 0,(function*(){return!!(yield this.getItemBy(-1))}))}getCurrentPageRoute(){return n.a.getCurrentRoute()}getSelectedItemPathFromRoute(t){const i=[];for(;t&&(i.push(...t.url),t.firstChild);)t=t.firstChild;return i.map((t=>t.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(t,i){return Object(o.a)(this,void 0,void 0,(function*(){const s=yield this.getItemBy(t);s&&(yield this.navigateToItem(s,{animationDirection:i,replace:!0}))}))}getItemBy(t){var i;return Object(o.a)(this,void 0,void 0,(function*(){const s=this.getSource().getItems(),o=null!==(i=this.selectedItem&&(null==s?void 0:s.indexOf(this.selectedItem)))&&void 0!==i?i:-1;if(-1===o||null===s)return null;const n=t>0?1:-1;let e=o,c=0;for(;c!==t;){if(e+=n,e<0)return null;if(e>=s.length)break;this.skipItemInSwipe(s[e])||(c+=n)}return c===t?s[e]:this.getSource().isCompleted()?null:(yield this.getSource().load(),this.getItemBy(t))}))}skipItemInSwipe(t){return!1}}}}]);