(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{cx1z:function(o,e,t){"use strict";t.r(e),t.d(e,"AddonCourseCompletionLazyModule",(function(){return x}));var c=t("L3Fv"),n=t("tyNb"),i=t("rGK3"),r=t("yQkb"),l=t("mrSG"),d=t("xd1G"),a=t("4pns"),s=t("D7J2"),p=t("pHTc"),_=t("9+EE"),m=t("3LXp"),u=t("j3ag"),C=t("8vmT"),g=t("fXoL"),f=t("TEn/"),h=t("nt/U"),E=t("PgjG"),D=t("ofXK"),P=t("FeAf"),A=t("hMzs"),R=t("ACYt"),I=t("3CSS"),T=t("sYmb"),w=t("uYHD");function AddonCourseCompletionReportPage_ion_item_14_Template(o,e){if(1&o&&(g.Ec(0,"ion-item",8),g.zc(1,"core-user-avatar",9),g.Ec(2,"ion-label"),g.Ec(3,"p",10),g.pd(4),g.Dc(),g.Dc(),g.Dc()),2&o){const o=g.Oc();g.lc(1),g.Vc("user",o.user)("courseId",o.courseId)("linkProfile",!1),g.lc(3),g.qd(o.user.fullname)}}function AddonCourseCompletionReportPage_ion_card_15_p_14_Template(o,e){1&o&&(g.Ec(0,"p"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&o&&(g.lc(1),g.qd(g.Qc(2,1,"addon.coursecompletion.criteriarequiredall")))}function AddonCourseCompletionReportPage_ion_card_15_p_15_Template(o,e){1&o&&(g.Ec(0,"p"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&o&&(g.lc(1),g.qd(g.Qc(2,1,"addon.coursecompletion.criteriarequiredany")))}function AddonCourseCompletionReportPage_ion_card_15_Template(o,e){if(1&o&&(g.Ec(0,"ion-card"),g.Ec(1,"ion-item",8),g.Ec(2,"ion-label"),g.Ec(3,"p",10),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Ec(6,"p"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(9,"ion-item",8),g.Ec(10,"ion-label"),g.Ec(11,"p",10),g.pd(12),g.Pc(13,"translate"),g.Dc(),g.nd(14,AddonCourseCompletionReportPage_ion_card_15_p_14_Template,3,3,"p",6),g.nd(15,AddonCourseCompletionReportPage_ion_card_15_p_15_Template,3,3,"p",6),g.Dc(),g.Dc(),g.Dc()),2&o){const o=g.Oc();g.lc(4),g.qd(g.Qc(5,5,"addon.coursecompletion.status")),g.lc(3),g.qd(g.Qc(8,7,o.statusText)),g.lc(5),g.qd(g.Qc(13,9,"addon.coursecompletion.required")),g.lc(2),g.Vc("ngIf",1===o.completion.aggregation),g.lc(1),g.Vc("ngIf",2===o.completion.aggregation)}}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template(o,e){1&o&&(g.Ec(0,"strong",17),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&o&&(g.lc(1),g.qd(g.Qc(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template(o,e){1&o&&(g.Ec(0,"strong",17),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&o&&(g.lc(1),g.qd(g.Qc(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template(o,e){if(1&o&&(g.Ec(0,"ion-item",14),g.Ec(1,"ion-label"),g.Ec(2,"p",10),g.zc(3,"core-format-text",15),g.Dc(),g.Ec(4,"p"),g.zc(5,"core-format-text",15),g.Dc(),g.Dc(),g.nd(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template,3,3,"strong",16),g.nd(7,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template,3,3,"strong",16),g.Dc()),2&o){const o=e.$implicit;g.lc(3),g.Vc("text",o.details.criteria)("filter",!1),g.lc(2),g.Vc("text",o.details.requirement)("filter",!1),g.lc(1),g.Vc("ngIf",o.complete),g.lc(1),g.Vc("ngIf",!o.complete)}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template(o,e){1&o&&(g.Ec(0,"ion-col"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&o&&(g.lc(1),g.qd(g.Qc(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template(o,e){1&o&&(g.Ec(0,"ion-col"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&o&&(g.lc(1),g.qd(g.Qc(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template(o,e){if(1&o&&(g.Ec(0,"ion-col"),g.pd(1),g.Pc(2,"coreFormatDate"),g.Dc()),2&o){const o=g.Oc().$implicit;g.lc(1),g.rd(" ",g.Rc(2,1,1e3*o.timecompleted,"strftimedatetimeshort")," ")}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template(o,e){1&o&&g.zc(0,"ion-col")}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template(o,e){if(1&o&&(g.Ec(0,"ion-row"),g.Ec(1,"ion-col"),g.zc(2,"core-format-text",15),g.Dc(),g.Ec(3,"ion-col"),g.zc(4,"core-format-text",15),g.Dc(),g.Ec(5,"ion-col"),g.zc(6,"core-format-text",15),g.Dc(),g.Ec(7,"ion-col"),g.zc(8,"core-format-text",18),g.Dc(),g.nd(9,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template,3,3,"ion-col",6),g.nd(10,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template,3,3,"ion-col",6),g.nd(11,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template,3,4,"ion-col",6),g.nd(12,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template,1,0,"ion-col",6),g.Dc()),2&o){const o=e.$implicit;g.lc(2),g.Vc("text",o.details.type)("filter",!1),g.lc(2),g.Vc("text",o.details.criteria)("filter",!1),g.lc(2),g.Vc("text",o.details.requirement)("filter",!1),g.lc(2),g.Vc("text",o.details.status)("filter",!1),g.lc(1),g.Vc("ngIf",o.complete),g.lc(1),g.Vc("ngIf",!o.complete),g.lc(1),g.Vc("ngIf",o.timecompleted),g.lc(1),g.Vc("ngIf",!o.timecompleted)}}function AddonCourseCompletionReportPage_ion_card_16_Template(o,e){if(1&o&&(g.Ec(0,"ion-card"),g.Ec(1,"ion-item-divider"),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.nd(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template,8,6,"ion-item",11),g.Ec(7,"ion-item",12),g.Ec(8,"ion-label"),g.Ec(9,"ion-row"),g.Ec(10,"ion-col"),g.Ec(11,"strong"),g.pd(12),g.Pc(13,"translate"),g.Dc(),g.Dc(),g.Ec(14,"ion-col"),g.Ec(15,"strong"),g.pd(16),g.Pc(17,"translate"),g.Dc(),g.Dc(),g.Ec(18,"ion-col"),g.Ec(19,"strong"),g.pd(20),g.Pc(21,"translate"),g.Dc(),g.Dc(),g.Ec(22,"ion-col"),g.Ec(23,"strong"),g.pd(24),g.Pc(25,"translate"),g.Dc(),g.Dc(),g.Ec(26,"ion-col"),g.Ec(27,"strong"),g.pd(28),g.Pc(29,"translate"),g.Dc(),g.Dc(),g.Ec(30,"ion-col"),g.Ec(31,"strong"),g.pd(32),g.Pc(33,"translate"),g.Dc(),g.Dc(),g.Dc(),g.nd(34,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template,13,12,"ion-row",13),g.Dc(),g.Dc(),g.Dc()),2&o){const o=g.Oc();g.lc(4),g.qd(g.Qc(5,9,"addon.coursecompletion.requiredcriteria")),g.lc(2),g.Vc("ngForOf",o.completion.completions),g.lc(6),g.qd(g.Qc(13,11,"addon.coursecompletion.criteriagroup")),g.lc(4),g.qd(g.Qc(17,13,"addon.coursecompletion.criteria")),g.lc(4),g.qd(g.Qc(21,15,"addon.coursecompletion.requirement")),g.lc(4),g.qd(g.Qc(25,17,"addon.coursecompletion.status")),g.lc(4),g.qd(g.Qc(29,19,"addon.coursecompletion.complete")),g.lc(4),g.qd(g.Qc(33,21,"addon.coursecompletion.completiondate")),g.lc(2),g.Vc("ngForOf",o.completion.completions)}}function AddonCourseCompletionReportPage_ion_card_17_Template(o,e){if(1&o){const o=g.Fc();g.Ec(0,"ion-card"),g.Ec(1,"ion-item-divider"),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-item"),g.Ec(7,"ion-label"),g.Ec(8,"ion-button",19),g.Mc("click",(function AddonCourseCompletionReportPage_ion_card_17_Template_ion_button_click_8_listener(){g.fd(o);return g.Oc().completeCourse()})),g.pd(9),g.Pc(10,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc()}2&o&&(g.lc(4),g.qd(g.Qc(5,2,"addon.coursecompletion.manualselfcompletion")),g.lc(5),g.rd(" ",g.Qc(10,4,"addon.coursecompletion.completecourse")," "))}function AddonCourseCompletionReportPage_ion_card_18_Template(o,e){1&o&&(g.Ec(0,"ion-card",20),g.Ec(1,"ion-item"),g.zc(2,"ion-icon",21),g.Ec(3,"ion-label"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc()),2&o&&(g.lc(4),g.qd(g.Qc(5,1,"addon.coursecompletion.nottracked")))}let b=(()=>{class AddonCourseCompletionReportPage{constructor(){this.completionLoaded=!1,this.showSelfComplete=!1,this.tracked=!0,this.logView=C.a.once((()=>{s.a.logEvent({type:s.b.VIEW_ITEM,ws:"core_completion_get_course_completion_status",name:u.I.instant("addon.coursecompletion.coursecompletion"),data:{course:this.courseId,user:this.userId},url:`/blocks/completionstatus/details.php?course=${this.courseId}&user=${this.userId}`})}))}ngOnInit(){try{this.courseId=p.a.getRequiredRouteNumberParam("courseId"),this.userId=p.a.getRouteNumberParam("userId")||_.c.getCurrentSiteUserId()}catch(o){return m.a.showErrorModal(o),p.a.back(),void 0}this.fetchCompletion().finally((()=>{this.completionLoaded=!0}))}fetchCompletion(){return Object(l.a)(this,void 0,void 0,(function*(){try{this.user=yield a.a.getProfile(this.userId,this.courseId,!0),this.completion=yield d.a.getCompletion(this.courseId,this.userId),this.statusText=d.a.getCompletedStatusText(this.completion),this.showSelfComplete=d.a.canMarkSelfCompleted(this.userId,this.completion),this.tracked=!0,this.logView()}catch(o){o&&"notenroled"==o.errorcode?this.tracked=!1:m.a.showErrorModalDefault(o,"addon.coursecompletion.couldnotloadreport",!0)}}))}refreshCompletion(o){return Object(l.a)(this,void 0,void 0,(function*(){yield d.a.invalidateCourseCompletion(this.courseId,this.userId).finally((()=>{this.fetchCompletion().finally((()=>{null==o?void 0:o.complete()}))}))}))}completeCourse(){return Object(l.a)(this,void 0,void 0,(function*(){const o=yield m.a.showModalLoading("core.sending",!0);try{yield d.a.markCourseAsSelfCompleted(this.courseId),yield this.refreshCompletion()}catch(o){m.a.showErrorModal(o)}finally{o.dismiss()}}))}}return AddonCourseCompletionReportPage.ɵfac=function AddonCourseCompletionReportPage_Factory(o){return new(o||AddonCourseCompletionReportPage)},AddonCourseCompletionReportPage.ɵcmp=g.sc({type:AddonCourseCompletionReportPage,selectors:[["page-addon-course-completion-report"]],decls:19,vars:16,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],["class","ion-hide-md-up ion-text-wrap",4,"ngFor","ngForOf"],[1,"ion-hide-md-down","ion-text-wrap"],[4,"ngFor","ngForOf"],[1,"ion-hide-md-up","ion-text-wrap"],["clean","true",3,"text","filter"],["slot","end",4,"ngIf"],["slot","end"],[3,"text","filter"],["expand","block",3,"click"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"]],template:function AddonCourseCompletionReportPage_Template(o,e){1&o&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(9,"ion-content"),g.Ec(10,"ion-refresher",2),g.Mc("ionRefresh",(function AddonCourseCompletionReportPage_Template_ion_refresher_ionRefresh_10_listener(o){return e.refreshCompletion(o.target)})),g.zc(11,"ion-refresher-content",3),g.Pc(12,"translate"),g.Dc(),g.Ec(13,"core-loading",4),g.nd(14,AddonCourseCompletionReportPage_ion_item_14_Template,5,4,"ion-item",5),g.nd(15,AddonCourseCompletionReportPage_ion_card_15_Template,16,11,"ion-card",6),g.nd(16,AddonCourseCompletionReportPage_ion_card_16_Template,35,23,"ion-card",6),g.nd(17,AddonCourseCompletionReportPage_ion_card_17_Template,11,6,"ion-card",6),g.nd(18,AddonCourseCompletionReportPage_ion_card_18_Template,6,3,"ion-card",7),g.Dc(),g.Dc()),2&o&&(g.lc(3),g.Vc("text",g.Qc(4,10,"core.back")),g.lc(4),g.qd(g.Qc(8,12,"addon.coursecompletion.coursecompletion")),g.lc(3),g.Vc("disabled",!e.completionLoaded),g.lc(1),g.Wc("pullingText",g.Qc(12,14,"core.pulltorefresh")),g.lc(2),g.Vc("hideUntil",e.completionLoaded),g.lc(1),g.Vc("ngIf",e.user),g.lc(1),g.Vc("ngIf",e.completion&&e.tracked),g.lc(1),g.Vc("ngIf",e.completion&&e.tracked),g.lc(1),g.Vc("ngIf",e.showSelfComplete&&e.tracked),g.lc(1),g.Vc("ngIf",!e.tracked))},directives:[f.C,f.Ab,f.m,f.h,f.i,f.yb,h.a,f.v,f.bb,f.cb,E.a,D.t,f.I,P.a,f.O,f.n,f.J,D.s,f.hb,f.u,A.a,R.a,f.l,f.D,I.a],pipes:[T.d,w.a],encapsulation:2}),AddonCourseCompletionReportPage})();const y=[{path:"",component:b}];let x=(()=>{class AddonCourseCompletionLazyModule{}return AddonCourseCompletionLazyModule.ɵmod=g.wc({type:AddonCourseCompletionLazyModule}),AddonCourseCompletionLazyModule.ɵinj=g.vc({factory:function AddonCourseCompletionLazyModule_Factory(o){return new(o||AddonCourseCompletionLazyModule)},imports:[[n.m.forChild(y),c.a,i.a,r.a],n.m]}),AddonCourseCompletionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&g.kd(x,{declarations:[b],imports:[n.m,c.a,i.a,r.a],exports:[n.m]}))}}]);