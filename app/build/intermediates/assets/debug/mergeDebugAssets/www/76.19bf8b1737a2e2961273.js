(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{KVTe:function(e,n,t){"use strict";t.r(n),t.d(n,"CoreLoginLazyModule",(function(){return Me}));var o=t("tyNb"),i=t("L3Fv"),c=t("mrSG"),r=t("9+EE"),a=t("bFG1"),l=t("j3ag"),s=t("mv9v"),g=t("fXoL");let d=(()=>{class CoreLoginHasSitesGuard{canActivate(){return this.guard()}canLoad(){return this.guard()}guard(){return Object(c.a)(this,void 0,void 0,(function*(){if((yield a.a.ignoreErrors(r.c.getSites(),[])).length>0)return!0;const[e,n]=yield s.a.getAddSiteRouteInfo(),t=l.D.parseUrl(e);return t.queryParams=n,t}))}}return CoreLoginHasSitesGuard.ɵfac=function CoreLoginHasSitesGuard_Factory(e){return new(e||CoreLoginHasSitesGuard)},CoreLoginHasSitesGuard.ɵprov=g.uc({token:CoreLoginHasSitesGuard,factory:CoreLoginHasSitesGuard.ɵfac,providedIn:"root"}),CoreLoginHasSitesGuard})();var _=t("ho2i"),u=t("3Pt+"),p=t("3LXp"),m=t("pHTc"),h=t("4reR"),f=t("r2Z7"),P=t("H8uD"),C=t("TEn/"),b=t("nt/U"),O=t("ofXK"),E=t("6uVz"),M=t("ACYt"),v=t("uI1u"),S=t("sYmb");const y=["resetPasswordForm"];function CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template(e,n){if(1&e&&(g.Ec(0,"core-login-exceeded-attempts",14),g.Pc(1,"translate"),g.pd(2),g.Pc(3,"translate"),g.Dc()),2&e){const e=g.Oc();g.Vc("supportConfig",e.supportConfig)("supportSubject",g.Qc(1,3,"core.login.exceededpasswordresetattemptssupportsubject")),g.lc(2),g.rd(" ",g.Qc(3,5,"core.login.exceededpasswordresetattempts")," ")}}let D=(()=>{class CoreLoginForgottenPasswordPage{constructor(e){this.formBuilder=e,this.wasPasswordResetRequestedRecently=!1}ngOnInit(){var e;return Object(c.a)(this,void 0,void 0,(function*(){const n=m.a.getRouteParam("siteUrl");if(!n)return p.a.showErrorModal("Site URL not supplied."),m.a.back(),void 0;const t=m.a.getRouteParam("siteConfig");this.siteUrl=n,this.autoFocus=f.a.is("tablet"),this.myForm=this.formBuilder.group({field:["username",u.F.required],value:[m.a.getRouteParam("username")||"",u.F.required]}),this.supportConfig=t&&new P.a(t),this.canContactSupport=null===(e=this.supportConfig)||void 0===e?void 0:e.canContactSupport(),this.wasPasswordResetRequestedRecently=yield s.a.wasPasswordResetRequestedRecently(n)}))}resetPassword(e){var n;return Object(c.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();const t=this.myForm.value.field,o=this.myForm.value.value;if(!o)return p.a.showErrorModal("core.login.usernameoremail",!0),void 0;const i=yield p.a.showModalLoading("core.sending",!0),c="email"===t;try{const e=yield s.a.requestPasswordReset(this.siteUrl,c?"":o,c?o:"");if("dataerror"===e.status){const t=null===(n=e.warnings)||void 0===n?void 0:n.find((e=>"email"===e.item&&c||"username"===e.item&&!c));t&&p.a.showErrorModal(t.message)}else"emailpasswordconfirmnotsent"===e.status||"emailpasswordconfirmnoemail"===e.status?p.a.showErrorModal(e.notice):(h.a.triggerFormSubmittedEvent(this.formElement,!0),yield p.a.showAlert(l.I.instant("core.success"),e.notice),yield m.a.back(),yield s.a.passwordResetRequested(this.siteUrl))}catch(e){p.a.showErrorModal(e)}finally{i.dismiss()}}))}}return CoreLoginForgottenPasswordPage.ɵfac=function CoreLoginForgottenPasswordPage_Factory(e){return new(e||CoreLoginForgottenPasswordPage)(g.yc(u.f))},CoreLoginForgottenPasswordPage.ɵcmp=g.sc({type:CoreLoginForgottenPasswordPage,selectors:[["page-core-login-forgotten-password"]],viewQuery:function CoreLoginForgottenPasswordPage_Query(e,n){var t;(1&e&&g.ud(y,!0),2&e)&&(g.dd(t=g.Nc())&&(n.formElement=t.first))},decls:45,vars:31,consts:[["slot","start"],[3,"text"],[1,"list-item-limited-width"],[3,"supportConfig","supportSubject",4,"ngIf"],[1,"ion-text-wrap"],[3,"formGroup","ngSubmit"],["resetPasswordForm",""],[1,"item-heading"],["formControlName","field"],["slot","end","value","username"],["slot","end","value","email"],[1,"sr-only"],["type","text","name","value","formControlName","value","autocapitalize","none","autocorrect","off",3,"placeholder","core-auto-focus"],["type","submit","expand","block",1,"ion-margin",3,"disabled"],[3,"supportConfig","supportSubject"]],template:function CoreLoginForgottenPasswordPage_Template(e,n){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(9,"ion-content"),g.Ec(10,"div",2),g.nd(11,CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template,4,7,"core-login-exceeded-attempts",3),g.Ec(12,"ion-list"),g.Ec(13,"ion-item",4),g.Ec(14,"ion-label"),g.pd(15),g.Pc(16,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(17,"ion-card"),g.Ec(18,"form",5,6),g.Mc("ngSubmit",(function CoreLoginForgottenPasswordPage_Template_form_ngSubmit_18_listener(e){return n.resetPassword(e)})),g.Ec(20,"ion-item-divider",4),g.Ec(21,"ion-label"),g.Ec(22,"p",7),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(25,"ion-radio-group",8),g.Ec(26,"ion-item"),g.Ec(27,"ion-label"),g.pd(28),g.Pc(29,"translate"),g.Dc(),g.zc(30,"ion-radio",9),g.Dc(),g.Ec(31,"ion-item"),g.Ec(32,"ion-label"),g.pd(33),g.Pc(34,"translate"),g.Dc(),g.zc(35,"ion-radio",10),g.Dc(),g.Dc(),g.Ec(36,"ion-item"),g.Ec(37,"ion-label",11),g.pd(38),g.Pc(39,"translate"),g.Dc(),g.zc(40,"ion-input",12),g.Pc(41,"translate"),g.Dc(),g.Ec(42,"ion-button",13),g.pd(43),g.Pc(44,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,13,"core.back")),g.lc(4),g.qd(g.Qc(8,15,"core.login.passwordforgotten")),g.lc(4),g.Vc("ngIf",n.canContactSupport&&n.wasPasswordResetRequestedRecently),g.lc(4),g.qd(g.Qc(16,17,"core.login.passwordforgotteninstructions2")),g.lc(3),g.Vc("formGroup",n.myForm),g.lc(5),g.qd(g.Qc(24,19,"core.login.searchby")),g.lc(5),g.qd(g.Qc(29,21,"core.login.username")),g.lc(5),g.qd(g.Qc(34,23,"core.user.email")),g.lc(5),g.qd(g.Qc(39,25,"core.login.usernameoremail")),g.lc(2),g.Wc("placeholder",g.Qc(41,27,"core.login.usernameoremail")),g.Vc("core-auto-focus",n.autoFocus),g.lc(2),g.Vc("disabled",!n.myForm.valid),g.lc(1),g.rd(" ",g.Qc(44,29,"core.courses.search")," "))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,b.a,C.v,O.t,C.P,C.I,C.O,C.n,u.H,u.s,u.k,C.J,C.Z,C.Ob,u.r,u.i,C.Y,C.Mb,C.H,C.Pb,E.a,M.a,C.l,v.a],pipes:[S.d],encapsulation:2}),CoreLoginForgottenPasswordPage})();var L=t("vbeB"),w=t("fjkH"),x=t("D7J2"),T=t("PgjG"),k=t("iSJP"),I=t("qNqN");function CoreLoginSitePolicyPage_ion_list_11_ion_card_12_Template(e,n){if(1&e&&(g.Ec(0,"ion-card",9),g.zc(1,"core-iframe",10),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("src",e.sitePolicy)}}function CoreLoginSitePolicyPage_ion_list_11_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-list"),g.Ec(1,"ion-item",4),g.Ec(2,"ion-label"),g.Ec(3,"p"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-item",4),g.Ec(7,"ion-label"),g.Ec(8,"p"),g.Ec(9,"a",5),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.nd(12,CoreLoginSitePolicyPage_ion_list_11_ion_card_12_Template,2,1,"ion-card",6),g.Ec(13,"ion-button",7),g.Mc("click",(function CoreLoginSitePolicyPage_ion_list_11_Template_ion_button_click_13_listener(){g.fd(e);return g.Oc().accept()})),g.pd(14),g.Pc(15,"translate"),g.Dc(),g.Ec(16,"ion-button",8),g.Mc("click",(function CoreLoginSitePolicyPage_ion_list_11_Template_ion_button_click_16_listener(){g.fd(e);return g.Oc().cancel()})),g.pd(17),g.Pc(18,"translate"),g.Dc(),g.Dc()}if(2&e){const e=g.Oc();g.lc(4),g.qd(g.Qc(5,7,"core.login.policyagree")),g.lc(5),g.Vc("href",e.sitePolicy,g.id)("capture",!1),g.lc(1),g.qd(g.Qc(11,9,"core.login.policyagreementclick")),g.lc(2),g.Vc("ngIf",e.showInline),g.lc(2),g.rd(" ",g.Qc(15,11,"core.login.policyacceptmandatory")," "),g.lc(3),g.rd(" ",g.Qc(18,13,"core.login.cancel")," ")}}let F=(()=>{class CoreLoginSitePolicyPage{ngOnInit(){this.siteId=m.a.getRouteParam("siteId");try{this.currentSite=r.c.getRequiredCurrentSite()}catch(e){return this.cancel(),void 0}const e=this.currentSite.id;if(this.siteId=this.siteId||e,this.siteId!=e)return this.cancel(),void 0;this.fetchSitePolicy()}fetchSitePolicy(){return Object(c.a)(this,void 0,void 0,(function*(){try{this.sitePolicy=yield s.a.getSitePolicy(this.siteId)}catch(e){return p.a.showErrorModalDefault(e,"Error getting site policy."),this.cancel(),void 0}try{const e=yield a.a.getMimeTypeFromUrl(this.sitePolicy),n=L.a.getExtension(e,this.sitePolicy);this.showInline="html"==n||"htm"==n}catch(e){this.showInline=!1}finally{this.policyLoaded=!0}x.a.logEvent({type:x.b.VIEW_ITEM,ws:"auth_email_get_signup_settings",name:l.I.instant("core.login.policyagreement"),data:{category:"policy"},url:"/user/policy.php"})}))}cancel(){return Object(c.a)(this,void 0,void 0,(function*(){yield a.a.ignoreErrors(r.c.logout()),yield m.a.navigate("/login/sites",{reset:!0})}))}accept(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield p.a.showModalLoading("core.sending",!0);try{yield s.a.acceptSitePolicy(this.siteId),yield a.a.ignoreErrors(this.currentSite.invalidateWsCache()),w.b.trigger(w.b.SITE_POLICY_AGREED,{},this.siteId),yield m.a.navigateToSiteHome()}catch(e){p.a.showErrorModalDefault(e,"Error accepting site policy.")}finally{e.dismiss()}}))}}return CoreLoginSitePolicyPage.ɵfac=function CoreLoginSitePolicyPage_Factory(e){return new(e||CoreLoginSitePolicyPage)},CoreLoginSitePolicyPage.ɵcmp=g.sc({type:CoreLoginSitePolicyPage,selectors:[["page-core-login-site-policy"]],decls:12,vars:8,consts:[["slot","start"],[3,"text"],[3,"hideUntil"],[4,"ngIf"],[1,"ion-text-wrap"],["core-link","",3,"href","capture"],["class","core-site-policy-iframe-container",4,"ngIf"],["expand","block",1,"ion-text-wrap","ion-margin-horizontal",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-horizontal","ion-margin-bottom",3,"click"],[1,"core-site-policy-iframe-container"],[3,"src"]],template:function CoreLoginSitePolicyPage_Template(e,n){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(9,"ion-content"),g.Ec(10,"core-loading",2),g.nd(11,CoreLoginSitePolicyPage_ion_list_11_Template,19,15,"ion-list",3),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,4,"core.back")),g.lc(4),g.qd(g.Qc(8,6,"core.login.policyagreement")),g.lc(3),g.Vc("hideUntil",n.policyLoaded),g.lc(1),g.Vc("ngIf",n.sitePolicy))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,b.a,C.v,T.a,O.t,C.P,C.I,C.O,k.a,M.a,C.l,C.n,I.a],pipes:[S.d],styles:["[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]   core-iframe[_ngcontent-%COMP%]{height:100%;width:100%}"]}),CoreLoginSitePolicyPage})();var V=t("5aQ+"),q=t("vuGA"),Q=t("JFK0"),R=t("Smo8"),U=t("whRm"),z=t("qgEA"),A=t("6s78"),N=t("3CSS"),j=t("FasJ"),B=t("FTxb"),H=t("lqoc"),G=t("hMzs"),W=t("f1LK");const $=["ageForm"],J=["signupFormEl"];function CoreLoginEmailSignupPage_ion_button_10_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",7),g.Mc("click",(function CoreLoginEmailSignupPage_ion_button_10_Template_ion_button_click_0_listener(){g.fd(e);return g.Oc().showAuthInstructions()})),g.Pc(1,"translate"),g.zc(2,"ion-icon",8),g.Dc()}2&e&&g.mc("aria-label",g.Qc(1,1,"core.login.instructions"))}function CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template(e,n){if(1&e&&(g.Ec(0,"ion-list",11),g.Ec(1,"ion-item",12),g.Ec(2,"ion-label"),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.Ec(5,"ion-button",13),g.pd(6),g.Pc(7,"translate"),g.Dc(),g.Dc()),2&e){const e=g.Oc(2);g.lc(3),g.rd(" ",g.Qc(4,4,"core.login.signuprequiredfieldnotsupported")," "),g.lc(2),g.Vc("href",e.signupUrl)("showBrowserWarning",!1),g.lc(1),g.rd(" ",g.Qc(7,6,"core.openinbrowser")," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_25_Template(e,n){if(1&e&&(g.Ec(0,"ion-select-option",25),g.pd(1),g.Dc()),2&e){const e=n.$implicit;g.Vc("value",e.code),g.lc(1),g.qd(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"form",15,16),g.Mc("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template_form_ngSubmit_0_listener(n){g.fd(e);return g.Oc(3).verifyAge(n)})),g.Ec(2,"ion-item-divider",12),g.Ec(3,"ion-label"),g.Ec(4,"h2"),g.pd(5),g.Pc(6,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(7,"ion-item",12),g.Ec(8,"ion-label",17),g.Ec(9,"span",18),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.Dc(),g.zc(12,"ion-input",19),g.Dc(),g.Ec(13,"ion-item",12),g.Ec(14,"ion-label",17),g.Ec(15,"span",18),g.pd(16),g.Pc(17,"translate"),g.Dc(),g.Dc(),g.Ec(18,"ion-select",20),g.Pc(19,"translate"),g.Pc(20,"translate"),g.Pc(21,"translate"),g.Ec(22,"ion-select-option",21),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.nd(25,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_25_Template,2,2,"ion-select-option",22),g.Dc(),g.Dc(),g.Ec(26,"div",11),g.Ec(27,"ion-button",23),g.pd(28),g.Pc(29,"translate"),g.Dc(),g.Dc(),g.Ec(30,"ion-item",12),g.Ec(31,"ion-label"),g.Ec(32,"p",24),g.pd(33),g.Pc(34,"translate"),g.Dc(),g.Ec(35,"p"),g.pd(36),g.Pc(37,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc()}if(2&e){const e=g.Oc(3);g.Vc("formGroup",e.ageVerificationForm),g.lc(5),g.qd(g.Qc(6,13,"core.agelocationverification")),g.lc(5),g.qd(g.Qc(11,15,"core.whatisyourage")),g.lc(6),g.qd(g.Qc(17,17,"core.wheredoyoulive")),g.lc(2),g.Vc("cancelText",g.Qc(19,19,"core.cancel"))("okText",g.Qc(20,21,"core.ok"))("placeholder",g.Qc(21,23,"core.login.selectacountry")),g.lc(5),g.qd(g.Qc(24,25,"core.login.selectacountry")),g.lc(2),g.Vc("ngForOf",e.countries),g.lc(2),g.Vc("disabled",!e.ageVerificationForm.valid),g.lc(1),g.rd(" ",g.Qc(29,27,"core.proceed")," "),g.lc(5),g.qd(g.Qc(34,29,"core.whyisthisrequired")),g.lc(3),g.qd(g.Qc(37,31,"core.explanationdigitalminor"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template(e,n){if(1&e&&(g.Ec(0,"p",42),g.pd(1),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.qd(e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template(e,n){if(1&e&&(g.Ec(0,"p",42),g.zc(1,"core-format-text",43),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.Vc("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template(e,n){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.qd(e.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_28_Template(e,n){if(1&e&&(g.Ec(0,"p",44),g.pd(1),g.Dc()),2&e){const e=g.Oc(4);g.lc(1),g.rd(" ",e.settings.passwordpolicy," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_51_Template(e,n){if(1&e&&(g.Ec(0,"ion-item",12),g.Ec(1,"ion-label",17),g.Ec(2,"span",18),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.zc(5,"ion-input",45),g.Pc(6,"translate"),g.zc(7,"core-input-errors",30),g.Dc()),2&e){const e=n.$implicit,t=g.Oc(4);g.lc(3),g.qd(g.Qc(4,6,"core.user."+e)),g.lc(2),g.Wc("placeholder",g.Qc(6,8,"core.user."+e)),g.Wc("formControlName",e),g.Vc("name",e),g.lc(2),g.Vc("control",t.signupForm.controls[e])("errorMessages",t.namefieldsErrors[e])}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_69_Template(e,n){if(1&e&&(g.Ec(0,"ion-select-option",25),g.pd(1),g.Dc()),2&e){const e=n.$implicit;g.Vc("value",e.code),g.lc(1),g.qd(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_core_user_profile_field_5_Template(e,n){if(1&e&&g.zc(0,"core-user-profile-field",47),2&e){const e=n.$implicit,t=g.Oc(5);g.Vc("field",e)("edit",!0)("signup",!0)("form",t.signupForm)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_Template(e,n){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item-divider",12),g.Ec(2,"ion-label"),g.Ec(3,"p",24),g.pd(4),g.Dc(),g.Dc(),g.Dc(),g.nd(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_core_user_profile_field_5_Template,1,4,"core-user-profile-field",46),g.Bc()),2&e){const e=n.$implicit;g.lc(4),g.qd(e.name),g.lc(1),g.Vc("ngForOf",e.fields)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_71_Template(e,n){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item-divider",12),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.Ec(4,"span",48),g.pd(5),g.Pc(6,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.zc(7,"core-recaptcha",49),g.Bc()),2&e){const e=g.Oc(4);g.lc(4),g.Vc("core-mark-required",!0),g.lc(1),g.qd(g.Qc(6,6,"core.login.security_question")),g.lc(2),g.Vc("publicKey",e.settings.recaptchapublickey)("model",e.captcha)("siteUrl",e.siteUrl)("showRequiredError",e.formSubmitClicked)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_72_Template(e,n){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item-divider",12),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-item",12),g.Ec(7,"ion-label"),g.Ec(8,"a",50),g.pd(9),g.Pc(10,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(11,"ion-item",12),g.Ec(12,"ion-label"),g.Ec(13,"span",48),g.pd(14),g.Pc(15,"translate"),g.Dc(),g.zc(16,"core-input-errors",30),g.Dc(),g.zc(17,"ion-checkbox",51),g.Dc(),g.Bc()),2&e){const e=g.Oc(4);g.lc(4),g.qd(g.Qc(5,7,"core.login.policyagreement")),g.lc(4),g.Vc("href",e.settings.sitepolicy,g.id),g.lc(1),g.rd(" ",g.Qc(10,9,"core.login.policyagreementclick")," "),g.lc(4),g.Vc("core-mark-required",!0),g.lc(1),g.qd(g.Qc(15,11,"core.login.policyacceptmandatory")),g.lc(2),g.Vc("control",e.signupForm.controls.policyagreed)("errorMessages",e.policyErrors)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"form",15,26),g.Mc("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template_form_ngSubmit_0_listener(n){g.fd(e);return g.Oc(3).create(n)})),g.Ec(2,"ion-item",27),g.Ec(3,"ion-label"),g.nd(4,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template,2,1,"p",28),g.nd(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template,2,2,"p",28),g.nd(6,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template,2,1,"p",6),g.Dc(),g.Dc(),g.Ec(7,"ion-item-divider",12),g.Ec(8,"ion-label"),g.Ec(9,"h2"),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(12,"ion-item",12),g.Ec(13,"ion-label",17),g.Ec(14,"span",18),g.pd(15),g.Pc(16,"translate"),g.Dc(),g.Dc(),g.zc(17,"ion-input",29),g.Pc(18,"translate"),g.zc(19,"core-input-errors",30),g.Dc(),g.Ec(20,"ion-item",12),g.Ec(21,"ion-label",17),g.Ec(22,"span",18),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.Dc(),g.Ec(25,"core-show-password",31),g.zc(26,"ion-input",32),g.Pc(27,"translate"),g.Dc(),g.nd(28,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_28_Template,2,1,"p",33),g.zc(29,"core-input-errors",30),g.Dc(),g.Ec(30,"ion-item-divider",12),g.Ec(31,"ion-label"),g.Ec(32,"h2"),g.pd(33),g.Pc(34,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(35,"ion-item",12),g.Ec(36,"ion-label",17),g.Ec(37,"span",18),g.pd(38),g.Pc(39,"translate"),g.Dc(),g.Dc(),g.zc(40,"ion-input",34),g.Pc(41,"translate"),g.zc(42,"core-input-errors",30),g.Dc(),g.Ec(43,"ion-item",12),g.Ec(44,"ion-label",17),g.Ec(45,"span",18),g.pd(46),g.Pc(47,"translate"),g.Dc(),g.Dc(),g.zc(48,"ion-input",35),g.Pc(49,"translate"),g.zc(50,"core-input-errors",30),g.Dc(),g.nd(51,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_51_Template,8,10,"ion-item",36),g.Ec(52,"ion-item",12),g.Ec(53,"ion-label",17),g.pd(54),g.Pc(55,"translate"),g.Dc(),g.zc(56,"ion-input",37),g.Pc(57,"translate"),g.Dc(),g.Ec(58,"ion-item",12),g.Ec(59,"ion-label",17),g.pd(60),g.Pc(61,"translate"),g.Dc(),g.Ec(62,"ion-select",38),g.Pc(63,"translate"),g.Pc(64,"translate"),g.Pc(65,"translate"),g.Ec(66,"ion-select-option",21),g.pd(67),g.Pc(68,"translate"),g.Dc(),g.nd(69,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_69_Template,2,2,"ion-select-option",22),g.Dc(),g.Dc(),g.nd(70,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_70_Template,6,2,"ng-container",39),g.nd(71,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_71_Template,8,8,"ng-container",6),g.nd(72,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_72_Template,18,13,"ng-container",6),g.Ec(73,"div",11),g.Ec(74,"ion-button",40),g.pd(75),g.Pc(76,"translate"),g.Dc(),g.zc(77,"input",41),g.Dc(),g.Dc()}if(2&e){const e=g.Oc(3);g.Vc("formGroup",e.signupForm),g.lc(4),g.Vc("ngIf",!e.siteName),g.lc(1),g.Vc("ngIf",e.siteName),g.lc(1),g.Vc("ngIf",e.siteName),g.lc(4),g.qd(g.Qc(11,38,"core.login.createuserandpass")),g.lc(5),g.qd(g.Qc(16,40,"core.login.username")),g.lc(2),g.Wc("placeholder",g.Qc(18,42,"core.login.username")),g.lc(2),g.Vc("control",e.signupForm.controls.username)("errorMessages",e.usernameErrors),g.lc(4),g.qd(g.Qc(24,44,"core.login.password")),g.lc(3),g.Wc("placeholder",g.Qc(27,46,"core.login.password")),g.Vc("clearOnEdit",!1),g.lc(2),g.Vc("ngIf",e.settings.passwordpolicy),g.lc(1),g.Vc("control",e.signupForm.controls.password)("errorMessages",e.passwordErrors),g.lc(4),g.qd(g.Qc(34,48,"core.login.supplyinfo")),g.lc(5),g.qd(g.Qc(39,50,"core.user.email")),g.lc(2),g.Wc("placeholder",g.Qc(41,52,"core.user.email")),g.lc(2),g.Vc("control",e.signupForm.controls.email)("errorMessages",e.emailErrors),g.lc(4),g.qd(g.Qc(47,54,"core.user.emailagain")),g.lc(2),g.Wc("placeholder",g.Qc(49,56,"core.user.emailagain")),g.Vc("pattern",e.escapeMail(e.signupForm.controls.email.value)),g.lc(2),g.Vc("control",e.signupForm.controls.email2)("errorMessages",e.email2Errors),g.lc(1),g.Vc("ngForOf",e.settings.namefields),g.lc(3),g.qd(g.Qc(55,58,"core.user.city")),g.lc(2),g.Wc("placeholder",g.Qc(57,60,"core.user.city")),g.lc(4),g.qd(g.Qc(61,62,"core.user.country")),g.lc(2),g.Vc("placeholder",g.Qc(63,64,"core.login.selectacountry"))("cancelText",g.Qc(64,66,"core.cancel"))("okText",g.Qc(65,68,"core.ok")),g.lc(5),g.qd(g.Qc(68,70,"core.login.selectacountry")),g.lc(2),g.Vc("ngForOf",e.countries),g.lc(1),g.Vc("ngForOf",e.categories),g.lc(1),g.Vc("ngIf",e.settings.recaptchapublickey),g.lc(1),g.Vc("ngIf",e.settings.sitepolicy),g.lc(3),g.qd(g.Qc(76,72,"core.login.createaccount"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template(e,n){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template,38,33,"form",14),g.nd(2,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template,78,74,"form",14),g.Bc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("ngIf",e.ageDigitalConsentVerification),g.lc(1),g.Vc("ngIf",!e.ageDigitalConsentVerification)}}function CoreLoginEmailSignupPage_core_loading_12_Template(e,n){if(1&e&&(g.Ec(0,"core-loading",9),g.Ec(1,"div",5),g.nd(2,CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template,8,8,"ion-list",10),g.nd(3,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template,3,2,"ng-container",6),g.Dc(),g.Dc()),2&e){const e=g.Oc();g.Vc("hideUntil",e.settingsLoaded),g.lc(2),g.Vc("ngIf",!e.allRequiredSupported),g.lc(1),g.Vc("ngIf",e.allRequiredSupported&&e.settingsLoaded&&e.settings)}}function CoreLoginEmailSignupPage_ion_list_14_h2_3_Template(e,n){if(1&e&&(g.Ec(0,"h2",54),g.zc(1,"core-format-text",43),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.Vc("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_ion_list_14_p_12_Template(e,n){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.qd(e.supportName)}}function CoreLoginEmailSignupPage_ion_list_14_p_13_Template(e,n){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc(2);g.lc(1),g.qd(e.supportEmail)}}function CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",55),g.Mc("click",(function CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template_ion_button_click_0_listener(){g.fd(e);return g.Oc(2).showContactOnSite()})),g.pd(1),g.Pc(2,"translate"),g.Dc()}2&e&&(g.lc(1),g.rd(" ",g.Qc(2,1,"core.openinbrowser")," "))}function CoreLoginEmailSignupPage_ion_list_14_Template(e,n){if(1&e&&(g.Ec(0,"ion-list"),g.Ec(1,"ion-item-divider",12),g.Ec(2,"ion-label"),g.nd(3,CoreLoginEmailSignupPage_ion_list_14_h2_3_Template,2,2,"h2",52),g.Dc(),g.Dc(),g.Ec(4,"ion-item",12),g.Ec(5,"ion-label"),g.Ec(6,"p",24),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Ec(9,"p"),g.pd(10),g.Pc(11,"translate"),g.Dc(),g.nd(12,CoreLoginEmailSignupPage_ion_list_14_p_12_Template,2,1,"p",6),g.nd(13,CoreLoginEmailSignupPage_ion_list_14_p_13_Template,2,1,"p",6),g.Dc(),g.Dc(),g.Ec(14,"div",11),g.nd(15,CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template,3,3,"ion-button",53),g.Dc(),g.Dc()),2&e){const e=g.Oc();g.lc(3),g.Vc("ngIf",e.siteName),g.lc(4),g.qd(g.Qc(8,6,"core.considereddigitalminor")),g.lc(3),g.qd(g.Qc(11,8,"core.digitalminor_desc")),g.lc(2),g.Vc("ngIf",e.supportName),g.lc(1),g.Vc("ngIf",e.supportEmail),g.lc(2),g.Vc("ngIf",!e.supportName&&!e.supportEmail)}}let K=(()=>{class CoreLoginEmailSignupPage{constructor(e,n,t){this.fb=e,this.elementRef=n,this.changeDetector=t,this.authInstructions="",this.settingsLoaded=!1,this.allRequiredSupported=!0,this.formSubmitClicked=!1,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.ageVerificationForm=this.fb.group({age:["",u.F.required]}),this.countryControl=this.fb.control("",u.F.required),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({username:["",u.F.required],password:["",u.F.required],email:["",u.F.compose([u.F.required,u.F.email])],email2:["",u.F.compose([u.F.required,u.F.email])]}),this.usernameErrors=s.a.getErrorMessages("core.login.usernamerequired"),this.passwordErrors=s.a.getErrorMessages("core.login.passwordrequired"),this.emailErrors=s.a.getErrorMessages("core.login.missingemail"),this.policyErrors=s.a.getErrorMessages("core.login.policyagree"),this.email2Errors=s.a.getErrorMessages("core.login.missingemail",void 0,"core.login.emailnotmatch")}ngOnInit(){const e=m.a.getRouteParam("siteUrl");if(!e)return p.a.showErrorModal("Site URL not supplied."),m.a.back(),void 0;this.siteUrl=e,this.fetchData().finally((()=>{this.settingsLoaded=!0}))}completeFormGroup(){var e,n,t,o,i;this.signupForm.addControl("city",this.fb.control((null===(e=this.settings)||void 0===e?void 0:e.defaultcity)||"")),this.signUpCountryControl=this.fb.control((null===(n=this.settings)||void 0===n?void 0:n.country)||""),this.signupForm.addControl("country",this.signUpCountryControl);for(const e in null===(t=this.settings)||void 0===t?void 0:t.namefields)this.signupForm.addControl(null===(o=this.settings)||void 0===o?void 0:o.namefields[e],this.fb.control("",u.F.required));(null===(i=this.settings)||void 0===i?void 0:i.sitepolicy)&&this.signupForm.addControl("policyagreed",this.fb.control(!1,u.F.requiredTrue))}fetchData(){return Object(c.a)(this,void 0,void 0,(function*(){try{if(this.siteConfig=yield r.c.getSitePublicConfig(this.siteUrl),this.signupUrl=z.a.concatenatePaths(this.siteConfig.httpswwwroot,"login/signup.php"),this.treatSiteConfig()){if(void 0===this.ageDigitalConsentVerification){const e=yield a.a.ignoreErrors(Q.a.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:this.siteUrl}));this.ageDigitalConsentVerification=!!(null==e?void 0:e.status)}yield this.getSignupSettings()}this.completeFormGroup()}catch(e){this.allRequiredSupported&&p.a.showErrorModal(e)}}))}getSignupSettings(){return Object(c.a)(this,void 0,void 0,(function*(){if(this.settings=yield Q.a.callAjax("auth_email_get_signup_settings",{},{siteUrl:this.siteUrl}),R.a.hasRequiredUnsupportedField(this.settings.profilefields))throw this.allRequiredSupported=!1,new Error(l.I.instant("core.login.signuprequiredfieldnotsupported"));this.categories=s.a.formatProfileFieldsForSignup(this.settings.profilefields),this.settings.recaptchapublickey&&(this.captcha.recaptcharesponse=""),this.countryControl.value||this.countryControl.setValue(this.settings.country||"");const e={};this.settings.namefields&&this.settings.namefields.forEach((n=>{e[n]=s.a.getErrorMessages("core.login.missing"+n)})),this.namefieldsErrors=e,this.countries=yield a.a.getCountryListSorted()}))}treatSiteConfig(){var e;return"email"!=(null===(e=this.siteConfig)||void 0===e?void 0:e.registerauth)||s.a.isEmailSignupDisabled(this.siteConfig)?(p.a.showErrorModal(l.I.instant("core.login.signupplugindisabled",{$a:l.I.instant("core.login.auth_email")})),m.a.back(),!1):(this.siteName=this.siteConfig.sitename,this.authInstructions=this.siteConfig.authinstructions,this.ageDigitalConsentVerification=this.siteConfig.agedigitalconsentverification,this.supportName=this.siteConfig.supportname,this.supportEmail=this.siteConfig.supportemail,this.countryControl.setValue(this.siteConfig.country||""),!0)}create(e){var n,t,o,i,r,a;return Object(c.a)(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),this.formSubmitClicked=!0,!this.signupForm.valid||(null===(n=this.settings)||void 0===n?void 0:n.recaptchapublickey)&&!this.captcha.recaptcharesponse){for(const e in this.signupForm.controls)this.signupForm.controls[e].markAsDirty();this.changeDetector.detectChanges();return(yield A.a.scrollToInputError(this.elementRef.nativeElement))||p.a.showErrorModal("core.errorinvalidform",!0),void 0}const c=yield p.a.showModalLoading("core.sending",!0),g={username:this.signupForm.value.username.trim().toLowerCase(),password:this.signupForm.value.password,firstname:q.b.cleanTags(this.signupForm.value.firstname),lastname:q.b.cleanTags(this.signupForm.value.lastname),email:this.signupForm.value.email.trim(),city:q.b.cleanTags(this.signupForm.value.city),country:this.signupForm.value.country};(null===(t=this.siteConfig)||void 0===t?void 0:t.launchurl)&&(g.redirect=s.a.prepareForSSOLogin(this.siteUrl,void 0,this.siteConfig.launchurl)),(null===(o=this.settings)||void 0===o?void 0:o.recaptchapublickey)&&this.captcha.recaptcharesponse&&(g.recaptcharesponse=this.captcha.recaptcharesponse);try{g.customprofilefields=yield R.a.getDataForFields(null===(i=this.settings)||void 0===i?void 0:i.profilefields,!0,"email",this.signupForm.value);const e=yield Q.a.callAjax("auth_email_signup_user",g,{siteUrl:this.siteUrl});if(e.success){h.a.triggerFormSubmittedEvent(this.signupFormElement,!0);const e=l.I.instant("core.login.emailconfirmsent",{$a:g.email});p.a.showAlert(l.I.instant("core.success"),e),m.a.back()}else{null===(r=this.recaptchaComponent)||void 0===r?void 0:r.expireRecaptchaAnswer();const n=null===(a=e.warnings)||void 0===a?void 0:a[0];if(n){let e=n.message;("incorrect-captcha-sol"==e||!e&&"recaptcharesponse"==n.item)&&(e=l.I.instant("core.login.recaptchaincorrect")),p.a.showErrorModal(e)}else p.a.showErrorModal("core.login.usernotaddederror",!0)}}catch(e){p.a.showErrorModalDefault(e,"core.login.usernotaddederror",!0)}finally{c.dismiss()}}))}escapeMail(e){return q.b.escapeForRegex(e)}showAuthInstructions(){q.b.viewText(l.I.instant("core.login.instructions"),this.authInstructions)}showContactOnSite(){a.a.openInBrowser(z.a.concatenatePaths(this.siteUrl,"/login/verify_age_location.php"),{showBrowserWarning:!1})}verifyAge(e){var n;return Object(c.a)(this,void 0,void 0,(function*(){if(e.preventDefault(),e.stopPropagation(),!this.ageVerificationForm.valid)return p.a.showErrorModal("core.errorinvalidform",!0),void 0;const t=yield p.a.showModalLoading("core.sending",!0),o=this.ageVerificationForm.value;o.age=parseInt(o.age,10);try{const e=yield Q.a.callAjax("core_auth_is_minor",o,{siteUrl:this.siteUrl});h.a.triggerFormSubmittedEvent(this.ageFormElement,!0),e.status?this.isMinor=!0:(this.countryControl.value&&(null===(n=this.signUpCountryControl)||void 0===n?void 0:n.setValue(this.countryControl.value)),this.ageDigitalConsentVerification=!1)}catch(e){p.a.showErrorModal("There was an error verifying your age, please try again using the browser.")}finally{t.dismiss()}}))}}return CoreLoginEmailSignupPage.ɵfac=function CoreLoginEmailSignupPage_Factory(e){return new(e||CoreLoginEmailSignupPage)(g.yc(u.f),g.yc(g.r),g.yc(g.j))},CoreLoginEmailSignupPage.ɵcmp=g.sc({type:CoreLoginEmailSignupPage,selectors:[["page-core-login-email-signup"]],viewQuery:function CoreLoginEmailSignupPage_Query(e,n){var t;(1&e&&(g.ud(U.a,!0),g.ud($,!0),g.ud(J,!0)),2&e)&&(g.dd(t=g.Nc())&&(n.recaptchaComponent=t.first),g.dd(t=g.Nc())&&(n.ageFormElement=t.first),g.dd(t=g.Nc())&&(n.signupFormElement=t.first))},decls:15,vars:9,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"hideUntil",4,"ngIf"],[1,"list-item-limited-width"],[4,"ngIf"],["fill","clear",3,"click"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[3,"hideUntil"],["class","ion-padding",4,"ngIf"],[1,"ion-padding"],[1,"ion-text-wrap"],["expand","block","core-link","","autoLogin","no",3,"href","showBrowserWarning"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["ageForm",""],["position","stacked"],["core-mark-required","true"],["type","number","name","age","placeholder","0","formControlName","age","autocapitalize","none","autocorrect","off"],["name","country","formControlName","country",3,"cancelText","okText","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",3,"disabled"],[1,"item-heading"],[3,"value"],["signupFormEl",""],[1,"ion-text-wrap","ion-text-center"],["class","ion-padding item-heading",4,"ngIf"],["type","text","name","username","formControlName","username","autocapitalize","none","autocorrect","off",3,"placeholder"],[3,"control","errorMessages"],["name","password"],["name","password","type","password","formControlName","password","autocomplete","new-password","required","true",3,"placeholder","clearOnEdit"],["class","core-input-footnote",4,"ngIf"],["type","email","name","email","formControlName","email","autocapitalize","none","autocorrect","off",3,"placeholder"],["type","email","name","email2","autocapitalize","none","formControlName","email2","autocorrect","off",3,"placeholder","pattern"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["type","text","name","city","formControlName","city","autocorrect","off",3,"placeholder"],["name","country","formControlName","country",3,"placeholder","cancelText","okText"],[4,"ngFor","ngForOf"],["expand","block","type","submit"],["type","submit",1,"core-submit-hidden-enter"],[1,"ion-padding","item-heading"],[3,"text","filter"],[1,"core-input-footnote"],["type","text","autocorrect","off",3,"name","placeholder","formControlName"],["registerAuth","email",3,"field","edit","signup","form",4,"ngFor","ngForOf"],["registerAuth","email",3,"field","edit","signup","form"],[3,"core-mark-required"],[3,"publicKey","model","siteUrl","showRequiredError"],["core-link","","capture","false",3,"href"],["slot","end","name","policyagreed","formControlName","policyagreed"],["class","item-heading ion-padding",4,"ngIf"],["expand","block",3,"click",4,"ngIf"],[1,"item-heading","ion-padding"],["expand","block",3,"click"]],template:function CoreLoginEmailSignupPage_Template(e,n){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Ec(9,"ion-buttons",2),g.nd(10,CoreLoginEmailSignupPage_ion_button_10_Template,3,3,"ion-button",3),g.Dc(),g.Dc(),g.Dc(),g.Ec(11,"ion-content"),g.nd(12,CoreLoginEmailSignupPage_core_loading_12_Template,4,3,"core-loading",4),g.Ec(13,"div",5),g.nd(14,CoreLoginEmailSignupPage_ion_list_14_Template,16,10,"ion-list",6),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,5,"core.back")),g.lc(4),g.qd(g.Qc(8,7,"core.login.newaccount")),g.lc(3),g.Vc("ngIf",n.authInstructions),g.lc(2),g.Vc("ngIf",!n.isMinor),g.lc(2),g.Vc("ngIf",n.allRequiredSupported&&n.isMinor))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,O.t,b.a,C.v,M.a,C.l,C.D,N.a,T.a,C.P,C.I,C.O,k.a,u.H,u.s,u.k,C.J,j.a,C.H,C.Jb,u.r,u.i,C.lb,C.Ob,C.mb,O.s,C.Pb,B.a,H.a,u.C,u.y,G.a,W.a,U.a,C.s,C.d],pipes:[S.d],styles:['[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:104px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:8px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size:var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font-size:16px}html.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], html.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}']}),CoreLoginEmailSignupPage})();var X=t("nvXB"),Y=t("GGba"),Z=t("BBqZ"),ee=t("93ts"),ne=t("BaYo"),te=t("oZnq"),oe=t("mvS9"),ie=t("JpIC"),ce=t("m2Ry"),re=t("y9BN"),ae=t("X3v+"),le=t("51eS"),se=t("cjIW"),ge=t("rdt7"),de=t("WDlY");let _e=(()=>{class CoreReferrerService{consumeInstallReferrerUrl(){var e;return Object(c.a)(this,void 0,void 0,(function*(){const n=de.a.plugin("installReferrer");if(!n)return;if(!(yield Z.a.get(CoreReferrerService.INSTALL_REFERRER_CONSUMED,0)))try{const t=yield n.getReferrer(),o=(null!==(e=t.referrer)&&void 0!==e?e:"").match(/siteurl=([^&]+)/);return null==o?void 0:o[1]}catch(e){}finally{yield Z.a.set(CoreReferrerService.INSTALL_REFERRER_CONSUMED,1)}}))}}return CoreReferrerService.INSTALL_REFERRER_CONSUMED="install_referrer_consumed",CoreReferrerService.ɵfac=function CoreReferrerService_Factory(e){return new(e||CoreReferrerService)},CoreReferrerService.ɵprov=g.uc({token:CoreReferrerService,factory:CoreReferrerService.ɵfac,providedIn:"root"}),CoreReferrerService})();const ue=Object(l.M)(_e),pe=["siteFormEl"];function CoreLoginSitePage_form_17_ng_container_2_Template(e,n){if(1&e&&(g.Cc(0),g.Ec(1,"ion-item"),g.Ec(2,"ion-label",15),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.zc(6,"ion-input",16),g.Pc(7,"translate"),g.Dc(),g.Bc()),2&e){const e=g.Oc(2);g.lc(4),g.qd(g.Qc(5,3,"core.login.siteaddress")),g.lc(2),g.Wc("placeholder",g.Qc(7,5,"core.login.siteaddressplaceholder")),g.Vc("core-auto-focus",e.showKeyboard&&!e.showScanQR)}}function CoreLoginSitePage_form_17_ng_container_3_ion_item_14_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",27),g.Mc("click",(function CoreLoginSitePage_form_17_ng_container_3_ion_item_14_Template_ion_item_click_0_listener(n){g.fd(e);const t=g.Oc(3);return t.connect(t.enteredSiteUrl.url,n)})),g.Pc(1,"translate"),g.Ec(2,"ion-thumbnail",28),g.zc(3,"ion-icon",29),g.Dc(),g.Ec(4,"ion-label"),g.Ec(5,"h2",30),g.pd(6),g.Pc(7,"translate"),g.Dc(),g.Ec(8,"p"),g.pd(9),g.Dc(),g.Dc(),g.Dc()}if(2&e){const e=g.Oc(3);g.mc("aria-label",g.Qc(1,3,"core.login.connect")),g.lc(6),g.qd(g.Qc(7,5,"core.login.yourenteredsite")),g.lc(3),g.qd(e.enteredSiteUrl.noProtocolUrl)}}function CoreLoginSitePage_form_17_ng_container_3_div_16_Template(e,n){1&e&&(g.Ec(0,"div",31),g.zc(1,"ion-spinner"),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.mc("aria-label",g.Qc(2,1,"core.loading")))}function CoreLoginSitePage_form_17_ng_container_3_ng_container_17_ng_container_1_Template(e,n){1&e&&g.Ac(0)}const site_c1=function(e){return{site:e}};function CoreLoginSitePage_form_17_ng_container_3_ng_container_17_Template(e,n){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginSitePage_form_17_ng_container_3_ng_container_17_ng_container_1_Template,1,0,"ng-container",32),g.Bc()),2&e){const e=n.$implicit;g.Oc(3);const t=g.ed(24);g.lc(1),g.Vc("ngTemplateOutlet",t)("ngTemplateOutletContext",g.ad(2,site_c1,e))}}function CoreLoginSitePage_form_17_ng_container_3_div_18_Template(e,n){1&e&&(g.Ec(0,"div",33),g.zc(1,"ion-spinner"),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.mc("aria-label",g.Qc(2,1,"core.loading")))}function CoreLoginSitePage_form_17_ng_container_3_Template(e,n){if(1&e){const e=g.Fc();g.Cc(0),g.Ec(1,"ion-item"),g.Ec(2,"ion-label",17),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Ec(6,"ion-input",18),g.Mc("ionChange",(function CoreLoginSitePage_form_17_ng_container_3_Template_ion_input_ionChange_6_listener(n){g.fd(e);const t=g.Oc(2);return t.searchSite(n,t.siteForm.value.siteUrl)})),g.Pc(7,"translate"),g.Dc(),g.Dc(),g.Ec(8,"ion-list",19),g.Ec(9,"ion-item",20),g.Ec(10,"ion-label"),g.Ec(11,"h2",21),g.pd(12),g.Pc(13,"translate"),g.Dc(),g.Dc(),g.Dc(),g.nd(14,CoreLoginSitePage_form_17_ng_container_3_ion_item_14_Template,10,7,"ion-item",22),g.Ec(15,"div",23),g.nd(16,CoreLoginSitePage_form_17_ng_container_3_div_16_Template,3,3,"div",24),g.nd(17,CoreLoginSitePage_form_17_ng_container_3_ng_container_17_Template,2,4,"ng-container",25),g.Dc(),g.Dc(),g.nd(18,CoreLoginSitePage_form_17_ng_container_3_div_18_Template,3,3,"div",26),g.Bc()}if(2&e){const e=g.Oc(2);g.lc(4),g.qd(g.Qc(5,14,"core.login.siteaddress")),g.lc(2),g.Wc("placeholder",g.Qc(7,16,"core.login.siteaddressplaceholder")),g.Vc("core-auto-focus",e.showKeyboard&&!e.showScanQR),g.lc(2),g.qc("hidden",!e.hasSites&&!e.enteredSiteUrl),g.lc(4),g.qd(g.Qc(13,18,"core.login.selectsite")),g.lc(2),g.Vc("ngIf",e.enteredSiteUrl),g.lc(1),g.qc("hidden",!e.hasSites)("dimmed",e.loadingSites),g.lc(1),g.Vc("ngIf",e.loadingSites),g.lc(1),g.Vc("ngForOf",e.sites),g.lc(1),g.Vc("ngIf",!e.hasSites&&e.loadingSites)}}function CoreLoginSitePage_form_17_ion_item_4_Template(e,n){if(1&e&&(g.Ec(0,"ion-item"),g.Ec(1,"ion-label"),g.Ec(2,"ion-button",34),g.pd(3),g.Pc(4,"translate"),g.Dc(),g.Dc(),g.Dc()),2&e){const e=g.Oc(2);g.lc(2),g.Vc("disabled",!e.siteForm.valid),g.lc(1),g.rd(" ",g.Qc(4,2,"core.login.connect")," ")}}function CoreLoginSitePage_form_17_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"form",13,14),g.Mc("ngSubmit",(function CoreLoginSitePage_form_17_Template_form_ngSubmit_0_listener(n){g.fd(e);const t=g.Oc();return t.connect(t.siteForm.value.siteUrl,n)})),g.nd(2,CoreLoginSitePage_form_17_ng_container_2_Template,8,7,"ng-container",10),g.nd(3,CoreLoginSitePage_form_17_ng_container_3_Template,19,20,"ng-container",10),g.nd(4,CoreLoginSitePage_form_17_ion_item_4_Template,5,4,"ion-item",10),g.Dc()}if(2&e){const e=g.Oc();g.Vc("formGroup",e.siteForm),g.lc(2),g.Vc("ngIf","url"==e.siteSelector),g.lc(1),g.Vc("ngIf","url"!=e.siteSelector),g.lc(1),g.Vc("ngIf","url"==e.siteSelector)}}function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-searchbar",36),g.Mc("ngModelChange",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ngModelChange_0_listener(n){g.fd(e);return g.Oc(3).filter=n}))("ionInput",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionInput_0_listener(n){g.fd(e);return g.Oc(3).filterChanged(n)}))("ionCancel",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionCancel_0_listener(){g.fd(e);return g.Oc(3).filterChanged()})),g.Pc(1,"translate"),g.Dc()}if(2&e){const e=g.Oc(3);g.Vc("ngModel",e.filter)("placeholder",g.Qc(1,2,"core.login.findyoursite"))}}function CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_ng_container_1_Template(e,n){1&e&&g.Ac(0)}function CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_Template(e,n){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_ng_container_1_Template,1,0,"ng-container",32),g.Bc()),2&e){const e=n.$implicit;g.Oc(3);const t=g.ed(24);g.lc(1),g.Vc("ngTemplateOutlet",t)("ngTemplateOutletContext",g.ad(2,site_c1,e))}}function CoreLoginSitePage_ng_container_18_ion_list_1_Template(e,n){if(1&e&&(g.Ec(0,"ion-list"),g.Ec(1,"ion-item"),g.Ec(2,"ion-label"),g.Ec(3,"h2",21),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.nd(6,CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template,2,4,"ion-searchbar",35),g.nd(7,CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_Template,2,4,"ng-container",25),g.Dc()),2&e){const e=g.Oc(2);g.lc(4),g.qd(g.Qc(5,3,"core.login.selectsite")),g.lc(2),g.Vc("ngIf",e.fixedSites.length>4),g.lc(1),g.Vc("ngForOf",e.filteredSites)}}function CoreLoginSitePage_ng_container_18_Template(e,n){if(1&e&&(g.Cc(0),g.nd(1,CoreLoginSitePage_ng_container_18_ion_list_1_Template,8,5,"ion-list",10),g.Bc()),2&e){const e=g.Oc();g.lc(1),g.Vc("ngIf","list"==e.siteSelector)}}function CoreLoginSitePage_ng_container_19_Template(e,n){if(1&e){const e=g.Fc();g.Cc(0),g.Ec(1,"div",37),g.pd(2),g.Pc(3,"translate"),g.Dc(),g.Ec(4,"ion-button",38),g.Mc("click",(function CoreLoginSitePage_ng_container_19_Template_ion_button_click_4_listener(){g.fd(e);return g.Oc().showInstructionsAndScanQR()})),g.zc(5,"ion-icon",39),g.pd(6),g.Pc(7,"translate"),g.Dc(),g.Bc()}2&e&&(g.lc(2),g.rd("",g.Qc(3,2,"core.login.or")," "),g.lc(4),g.rd(" ",g.Qc(7,4,"core.scanqr")," "))}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_1_Template(e,n){if(1&e&&g.zc(0,"img",45),2&e){const e=g.Oc(2).site;g.Vc("src",e.imageurl,g.id)}}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_2_Template(e,n){1&e&&g.zc(0,"img",46)}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_Template(e,n){if(1&e&&(g.Ec(0,"ion-thumbnail",0),g.nd(1,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_1_Template,1,1,"img",43),g.nd(2,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_2_Template,1,0,"img",44),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.Vc("ngIf",e.imageurl),g.lc(1),g.Vc("ngIf",!e.imageurl)}}function CoreLoginSitePage_ng_template_23_p_3_Template(e,n){if(1&e&&(g.Ec(0,"p",47),g.pd(1),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(e.title)}}function CoreLoginSitePage_ng_template_23_p_4_Template(e,n){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(e.noProtocolUrl)}}function CoreLoginSitePage_ng_template_23_p_5_Template(e,n){if(1&e&&(g.Ec(0,"p"),g.pd(1),g.Dc()),2&e){const e=g.Oc().site;g.lc(1),g.qd(e.location)}}function CoreLoginSitePage_ng_template_23_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",40),g.Mc("click",(function CoreLoginSitePage_ng_template_23_Template_ion_item_click_0_listener(t){g.fd(e);const o=n.site;return g.Oc().connect(o.url,t,o)})),g.nd(1,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_Template,3,2,"ion-thumbnail",41),g.Ec(2,"ion-label"),g.nd(3,CoreLoginSitePage_ng_template_23_p_3_Template,2,1,"p",42),g.nd(4,CoreLoginSitePage_ng_template_23_p_4_Template,2,1,"p",10),g.nd(5,CoreLoginSitePage_ng_template_23_p_5_Template,2,1,"p",10),g.Dc(),g.Dc()}if(2&e){const e=n.site,t=g.Oc();g.Vc("ngClass",e.className),g.mc("aria-label",e.name),g.lc(1),g.Vc("ngIf",t.siteFinderSettings.displayimage),g.lc(2),g.Vc("ngIf",e.title),g.lc(1),g.Vc("ngIf",e.noProtocolUrl),g.lc(1),g.Vc("ngIf",e.location)}}let me=(()=>{class CoreLoginSitePage{constructor(e){this.formBuilder=e,this.siteSelector="sitefinder",this.showKeyboard=!1,this.filter="",this.sites=[],this.hasSites=!1,this.loadingSites=!1}ngOnInit(){var e;return Object(c.a)(this,void 0,void 0,(function*(){let n="";this.siteSelector=ne.a.CONFIG.multisitesdisplay;this.siteFinderSettings=Object.assign({displaysitename:!0,displayimage:!0,displayalias:!0,displaycity:!0,displaycountry:!0,displayurl:!0},ne.a.CONFIG.sitefindersettings||{});if((yield s.a.getAvailableSites()).length)n=yield this.initSiteSelector();else{n=null!==(e=yield this.consumeInstallReferrerUrl())&&void 0!==e?e:"";const t=ne.a.CONFIG.enableonboarding&&!f.a.isIOS();n?(this.connect(n),t&&Z.a.set(s.b.ONBOARDING_DONE,1)):t&&this.initOnboarding()}this.showScanQR=s.a.displayQRInSiteScreen(),this.siteForm=this.formBuilder.group({siteUrl:[n,this.moodleUrlValidator()]}),this.searchFunction=a.a.debounce((e=>Object(c.a)(this,void 0,void 0,(function*(){if((e=e.trim()).length>=3){const n=yield r.c.findSites(e);this.sites=this.extendCoreLoginSiteInfo(n),this.hasSites=!!this.sites.length}else this.hasSites=!1;this.loadingSites=!1}))),1e3),this.showKeyboard=!!m.a.getRouteBooleanParam("showKeyboard")}))}initSiteSelector(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield s.a.getAvailableSites();return this.fixedSites=this.extendCoreLoginSiteInfo(e),this.siteSelector="list",this.fixedSites.some((e=>!!e.imageurl))||(this.siteFinderSettings.displayimage=!1),this.filteredSites=this.fixedSites,this.fixedSites[0].url}))}consumeInstallReferrerUrl(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield a.a.ignoreErrors(a.a.timeoutPromise(ue.consumeInstallReferrerUrl(),1e3));if(!e)return;return(yield a.a.ignoreErrors(r.c.getSites(),[])).length>0?void 0:e}))}initOnboarding(){return Object(c.a)(this,void 0,void 0,(function*(){(yield Z.a.get(s.b.ONBOARDING_DONE,!1))||this.showOnboarding()}))}extendCoreLoginSiteInfo(e){return e.map((e=>{e.noProtocolUrl=this.siteFinderSettings.displayurl&&e.url?te.a.removeProtocol(e.url):"";const n=this.siteFinderSettings.displaysitename?e.name:"",t=this.siteFinderSettings.displayalias&&e.alias?e.alias:"";e.title=n&&t?n+" ("+t+")":n+t;const o=this.siteFinderSettings.displaycountry&&e.countrycode?a.a.getCountryName(e.countrycode):"",i=this.siteFinderSettings.displaycity&&e.city?e.city:"";return e.location=i&&o?i+" - "+o:i+o,r.c.hasDefaultImage(e)&&this.siteFinderSettings.defaultimageurl&&(e.imageurl=this.siteFinderSettings.defaultimageurl),e}))}moodleUrlValidator(){return e=>{const n=e.value.trim();let t=n.length>=3&&te.a.isValidMoodleUrl(n);if(!t){!!r.c.getDemoSiteData(n)&&(t=!0)}return t?null:{siteUrl:{value:e.value}}}}showHelp(){return Object(c.a)(this,void 0,void 0,(function*(){yield p.a.openModal({component:ie.a,cssClass:"core-modal-fullscreen"})}))}showOnboarding(){return Object(c.a)(this,void 0,void 0,(function*(){yield p.a.openModal({component:ce.a,cssClass:"core-modal-fullscreen"})}))}connect(e,n,t){return Object(c.a)(this,void 0,void 0,(function*(){if(null==n?void 0:n.preventDefault(),null==n||n.stopPropagation(),X.a.closeKeyboard(),!e)return p.a.showErrorModal("core.login.siteurlrequired",!0),void 0;if(!Y.a.isOnline())return p.a.showErrorModal("core.networkerrormsg",!0),void 0;if((e=e.trim()).match(/^(https?:\/\/)?campus\.example\.edu/))return this.showLoginIssue(null,new ee.a(l.I.instant("core.login.errorexampleurl"))),void 0;const o=r.c.getDemoSiteData(e);if(o)yield this.loginDemoSite(o);else{const n=yield p.a.showModalLoading();let o;try{o=yield r.c.checkSite(e)}catch(t){const i=te.a.guessMoodleDomain(e);if(!i||i==e)return n.dismiss(),this.showLoginIssue(e,t);try{o=yield r.c.checkSite(i)}catch(o){return n.dismiss(),this.showLoginIssue(e,t||o)}}yield this.login(o,t),n.dismiss()}}))}loginDemoSite(e){return Object(c.a)(this,void 0,void 0,(function*(){const n=yield p.a.showModalLoading();try{const n=yield r.c.getUserToken(e.url,e.username,e.password);return yield r.c.newSite(n.siteUrl,n.token,n.privateToken),h.a.triggerFormSubmittedEvent(this.formElement,!0),yield m.a.navigateToSiteHome(),void 0}catch(n){s.a.treatUserTokenError(e.url,n,e.username,e.password),n.loggedout&&m.a.navigate("/login/sites",{reset:!0})}finally{n.dismiss()}}))}login(e,n){return Object(c.a)(this,void 0,void 0,(function*(){try{yield r.c.checkApplication(e.config),h.a.triggerFormSubmittedEvent(this.formElement,!0);const t={siteCheck:e};n&&!this.fixedSites&&(t.siteName=n.name,t.logoUrl=n.imageurl),m.a.navigate("/login/credentials",{params:t})}catch(e){}}))}showLoginIssue(e,n){return Object(c.a)(this,void 0,void 0,(function*(){let e,t,o,i,c=p.a.getErrorMessage(n),r=!1;n instanceof ae.a&&(e=n.supportConfig,o=n.errorDetails,i=n.errorcode,r=e instanceof P.a),n instanceof ge.a&&(t=n.title),o&&(c=`<p>${c}</p><div class="core-error-info-container"></div>`);const a=e,s=[{text:l.I.instant("core.tryagain"),role:"cancel"},(null==a?void 0:a.canContactSupport())?{text:l.I.instant("core.contactsupport"),handler:()=>le.a.contact({supportConfig:a,subject:l.I.instant("core.cannotconnect"),message:`Error: ${i}\n\n${o}`})}:r?null:{text:l.I.instant("core.needhelp"),cssClass:"core-login-need-help",handler:()=>this.showHelp()}].filter((e=>!!e)),g=yield p.a.showAlertWithOptions({header:null!=t?t:l.I.instant("core.cannotconnect"),message:null!=c?c:l.I.instant("core.sitenotfoundhelp"),buttons:s});if(o){const e=g.querySelector(".core-error-info-container");e&&(e.innerHTML=se.a.render(o,i))}}))}filterChanged(e){var n;const t=null===(n=null==e?void 0:e.target.value)||void 0===n?void 0:n.trim().toLowerCase();this.filteredSites=t&&this.fixedSites?this.fixedSites.filter((e=>e.title.toLowerCase().indexOf(t)>-1||e.noProtocolUrl.toLowerCase().indexOf(t)>-1||e.location.toLowerCase().indexOf(t)>-1)):this.fixedSites}searchSite(e,n){this.loadingSites=!0,n=n.trim(),this.enteredSiteUrl=this.siteForm.valid&&n.length>=3?{url:n,name:"connect",title:"",location:"",noProtocolUrl:te.a.removeProtocol(n)}:void 0,this.searchFunction(n.trim())}showInstructionsAndScanQR(){return Object(c.a)(this,void 0,void 0,(function*(){try{yield s.a.showScanQRInstructions(),yield this.scanQR()}catch(e){}}))}scanQR(){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield a.a.scanQR();if(!e)return;if(re.a.isCustomURL(e)){try{yield re.a.handleCustomURL(e)}catch(n){n&&n.data&&n.data.isAuthenticationURL&&n.data.siteUrl?this.treatErrorInAuthenticationCustomURL(e,n):re.a.treatHandleCustomURLError(n)}return}const n=oe.a.getUrlProtocol(e);if(n&&"http"!=n&&"https"!=n)return p.a.showErrorModal(l.I.instant("core.errorurlschemeinvalidscheme",{$a:e})),void 0;(yield s.a.isSiteUrlAllowed(e))?(this.siteForm.controls.siteUrl.setValue(e),this.connect(e)):p.a.showErrorModal("core.errorurlschemeinvalidsite",!0)}))}treatErrorInAuthenticationCustomURL(e,n){var t;return Object(c.a)(this,void 0,void 0,(function*(){const e=(null===(t=n.data)||void 0===t?void 0:t.siteUrl)||"",o=yield p.a.showModalLoading();this.siteForm.controls.siteUrl.setValue(e);try{const n=yield r.c.checkSite(e);yield r.c.checkApplication(n.config),s.a.isSSOLoginNeeded(n.code)||(yield m.a.navigate("/login/credentials",{params:{siteCheck:n}}))}catch(e){}finally{o.dismiss()}n.error=q.b.addTextToError(n.error,"<br><br>"+l.I.instant("core.login.youcanstillconnectwithcredentials")),re.a.treatHandleCustomURLError(n)}))}openSettings(){m.a.navigate("/settings")}}return CoreLoginSitePage.ɵfac=function CoreLoginSitePage_Factory(e){return new(e||CoreLoginSitePage)(g.yc(u.f))},CoreLoginSitePage.ɵcmp=g.sc({type:CoreLoginSitePage,selectors:[["page-core-login-site"]],viewQuery:function CoreLoginSitePage_Query(e,n){var t;(1&e&&g.ud(pe,!0),2&e)&&(g.dd(t=g.Nc())&&(n.formElement=t.first))},decls:25,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"ion-padding"],[1,"list-item-limited-width"],[1,"ion-text-center","ion-padding","ion-margin-bottom","core-login-site-logo"],["src","assets/img/login_logo.png","role","presentation","alt","",1,"avatar-full","login-logo"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],["aria-haspopup","dialog","expand","block","fill","clear",1,"ion-margin-top","core-login-need-help","core-button-as-link","ion-text-wrap",3,"click"],["sitelisting",""],[3,"formGroup","ngSubmit"],["siteFormEl",""],["position"," stacked"],["name","url","type","url","formControlName","siteUrl",3,"placeholder","core-auto-focus"],["position","stacked"],["name","url","formControlName","siteUrl",3,"placeholder","core-auto-focus","ionChange"],[1,"core-login-site-list"],[1,"core-login-site-list-title"],[1,"item-heading"],["button","","detail","true","class","core-login-entered-site",3,"click",4,"ngIf"],[1,"core-login-site-list-found"],["class","core-login-site-list-loading",4,"ngIf"],[4,"ngFor","ngForOf"],["class","core-login-site-nolist-loading",4,"ngIf"],["button","","detail","true",1,"core-login-entered-site",3,"click"],["slot","start","aria-hidden","true"],["name","fas-pen","aria-hidden","true"],[1,"ion-text-wrap"],[1,"core-login-site-list-loading"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"core-login-site-nolist-loading"],["expand","block","type","submit",1,"ion-text-wrap",3,"disabled"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel"],[1,"ion-text-center","ion-padding","ion-margin-top","core-login-site-qrcode-separator"],["expand","block","fill","outline","aria-haspopup","dialog",1,"ion-margin","core-login-site-qrcode",3,"click"],["slot","start","name","fas-qrcode","aria-hidden","true"],["button","","detail","true",3,"ngClass","click"],["slot","start",4,"ngIf"],["class","item-heading ion-text-wrap",4,"ngIf"],["onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src",4,"ngIf"],["src","assets/icon/icon.png","class","core-login-default-icon","alt","","role","presentation",4,"ngIf"],["onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src"],["src","assets/icon/icon.png","alt","","role","presentation",1,"core-login-default-icon"],[1,"item-heading","ion-text-wrap"]],template:function CoreLoginSitePage_Template(e,n){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Ec(9,"ion-buttons",2),g.Ec(10,"ion-button",3),g.Mc("click",(function CoreLoginSitePage_Template_ion_button_click_10_listener(){return n.openSettings()})),g.Pc(11,"translate"),g.zc(12,"ion-icon",4),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(13,"ion-content",5),g.Ec(14,"div",6),g.Ec(15,"div",7),g.zc(16,"img",8),g.Dc(),g.nd(17,CoreLoginSitePage_form_17_Template,5,4,"form",9),g.nd(18,CoreLoginSitePage_ng_container_18_Template,2,1,"ng-container",10),g.nd(19,CoreLoginSitePage_ng_container_19_Template,8,6,"ng-container",10),g.Ec(20,"ion-button",11),g.Mc("click",(function CoreLoginSitePage_Template_ion_button_click_20_listener(){return n.showHelp()})),g.pd(21),g.Pc(22,"translate"),g.Dc(),g.Dc(),g.Dc(),g.nd(23,CoreLoginSitePage_ng_template_23_Template,6,6,"ng-template",null,12,g.od)),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,9,"core.back")),g.lc(4),g.qd(g.Qc(8,11,"core.login.connecttomoodle")),g.lc(3),g.mc("aria-label",g.Qc(11,13,"core.settings.appsettings")),g.lc(5),g.qc("hidden",n.hasSites||n.enteredSiteUrl),g.lc(2),g.Vc("ngIf",!n.fixedSites&&n.siteForm),g.lc(1),g.Vc("ngIf",n.fixedSites),g.lc(1),g.Vc("ngIf",n.showScanQR&&!n.hasSites&&!n.enteredSiteUrl),g.lc(2),g.rd(" ",g.Qc(22,15,"core.needhelp")," "))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,M.a,C.l,C.D,N.a,b.a,C.v,O.t,u.H,u.s,u.k,C.I,C.O,C.H,C.Pb,u.r,u.i,E.a,C.P,O.s,C.xb,C.qb,O.A,C.ib,u.u,O.q],pipes:[S.d],styles:["[_nghost-%COMP%]{--list-item-max-width:600px}.item-input[_ngcontent-%COMP%]:last-child{margin-bottom:20px}.core-login-site-connect[_ngcontent-%COMP%]{margin-top:1.4rem}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{min-width:50px;min-height:50px;width:50px;height:50px;border-radius:20%;box-shadow:0 0 4px var(--gray-200);text-align:center;overflow:hidden}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:50px;max-width:-webkit-fit-content;max-width:fit-content;width:auto;height:auto;margin:0 auto 0 50%;transform:translate3d(-50%,0,0);object-fit:cover;object-position:50% 50%}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(calc(-1 * -50%),0,0)}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:dir(rtl){transform:translate3d(calc(-1 * -50%),0,0)}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 auto;font-size:35px;height:50px}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:0;margin-right:50%}.core-login-site-list[_ngcontent-%COMP%], .core-login-site-list-found[_ngcontent-%COMP%], .core-login-site-logo[_ngcontent-%COMP%]{transition-delay:0s;visibility:visible;opacity:1;transition:all .7s ease-in-out;max-height:9999px}.core-login-site-list-found.hidden[_ngcontent-%COMP%], .core-login-site-list.hidden[_ngcontent-%COMP%], .core-login-site-logo.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden;margin-top:0;margin-bottom:0;padding:0;max-height:0}.core-login-site-list-found.dimmed[_ngcontent-%COMP%]{pointer-events:none;position:relative}.core-login-site-list-loading[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;display:flex;align-content:center;align-items:center;background-color:hsla(0,0%,100%,.5);z-index:1}.core-login-site-list-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin:0 auto}.core-login-site-nolist-loading[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2.item-heading[_ngcontent-%COMP%]{margin-top:0}@media (min-width:768px){ion-content[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{margin-top:20%}ion-content[_ngcontent-%COMP%]   .core-login-site-logo.hidden[_ngcontent-%COMP%]{margin-top:0}}.core-login-entered-site[_ngcontent-%COMP%]{background-color:var(--light)}.core-login-entered-site[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{box-shadow:0 0 4px var(--gray-300)}.core-login-default-icon[_ngcontent-%COMP%]{filter:grayscale(100%)}",'[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background:var(--core-login-background);--ion-item-background:var(--core-login-background)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color:var(--core-login-text-color);-webkit-text-decoration-color:var(--core-login-text-color);text-decoration-color:var(--core-login-text-color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:var(--core-login-text-color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:104px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:8px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size:var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item.item-input[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background:var(--core-login-input-background);--color:var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-sitename[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font-size:16px}html.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], html.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background:var(--core-login-background-dark);--loading-text-color:#fff;--loading-spinner:#fff}']}),CoreLoginSitePage})();var he=t("tS8V"),fe=t("MUy3"),Pe=t("yNDK"),Ce=t("FeAf");function CoreLoginSitesPage_ion_button_10_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",13),g.Mc("click",(function CoreLoginSitesPage_ion_button_10_Template_ion_button_click_0_listener(){g.fd(e);return g.Oc().toggleDelete()})),g.Pc(1,"translate"),g.zc(2,"ion-icon",14),g.Dc()}2&e&&g.mc("aria-label",g.Qc(1,1,"core.login.toggleremove"))}function CoreLoginSitesPage_ion_card_17_ion_item_divider_1_Template(e,n){if(1&e&&(g.Ec(0,"ion-item-divider",17),g.Ec(1,"ion-label"),g.Ec(2,"h2"),g.zc(3,"core-format-text",18),g.Dc(),g.Ec(4,"p"),g.Ec(5,"a",19),g.pd(6),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e){const e=g.Oc().$implicit;g.lc(3),g.Vc("text",e[0].siteName)("siteId",e[0].id),g.lc(2),g.Vc("href",e[0].siteUrl,g.id),g.lc(1),g.qd(e[0].siteUrlWithoutProtocol)}}const sites_c0=function(e){return{count:e}};function CoreLoginSitesPage_ion_card_17_ion_item_2_ion_badge_5_Template(e,n){if(1&e&&(g.Ec(0,"ion-badge",2),g.Ec(1,"span",25),g.pd(2),g.Dc(),g.Ec(3,"span",12),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc()),2&e){const e=g.Oc().$implicit;g.Vc("@coreShowHideAnimation",void 0),g.lc(2),g.qd(e.badge),g.lc(2),g.qd(g.Rc(5,3,"core.login.sitebadgedescription",g.ad(6,sites_c0,e.badge)))}}function CoreLoginSitesPage_ion_card_17_ion_item_2_ion_button_6_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-button",26),g.Mc("click",(function CoreLoginSitesPage_ion_card_17_ion_item_2_ion_button_6_Template_ion_button_click_0_listener(n){g.fd(e);const t=g.Oc().$implicit;return g.Oc(2).deleteSite(n,t)})),g.Pc(1,"translate"),g.zc(2,"ion-icon",27),g.Dc()}2&e&&(g.Vc("@coreSlideInOut","fromRight"),g.mc("aria-label",g.Qc(1,2,"core.login.removeaccount")))}function CoreLoginSitesPage_ion_card_17_ion_item_2_Template(e,n){if(1&e){const e=g.Fc();g.Ec(0,"ion-item",20),g.Mc("click",(function CoreLoginSitesPage_ion_card_17_ion_item_2_Template_ion_item_click_0_listener(t){g.fd(e);const o=n.$implicit;return g.Oc(2).login(t,o.id)})),g.zc(1,"core-user-avatar",21),g.Ec(2,"ion-label"),g.Ec(3,"p",22),g.pd(4),g.Dc(),g.Dc(),g.nd(5,CoreLoginSitesPage_ion_card_17_ion_item_2_ion_badge_5_Template,6,8,"ion-badge",23),g.nd(6,CoreLoginSitesPage_ion_card_17_ion_item_2_ion_button_6_Template,3,4,"ion-button",24),g.Dc()}if(2&e){const e=n.$implicit,t=g.Oc(2);g.lc(1),g.Vc("user",e)("linkProfile",!1)("siteId",e.id),g.lc(3),g.qd(e.fullname),g.lc(1),g.Vc("ngIf",!t.showDelete&&e.badge),g.lc(1),g.Vc("ngIf",t.showDelete)}}function CoreLoginSitesPage_ion_card_17_Template(e,n){if(1&e&&(g.Ec(0,"ion-card"),g.nd(1,CoreLoginSitesPage_ion_card_17_ion_item_divider_1_Template,7,4,"ion-item-divider",15),g.nd(2,CoreLoginSitesPage_ion_card_17_ion_item_2_Template,7,6,"ion-item",16),g.Dc()),2&e){const e=n.$implicit;g.lc(1),g.Vc("ngIf",e[0]),g.lc(1),g.Vc("ngForOf",e)}}let be=(()=>{class CoreLoginSitesPage{constructor(){this.accountsList={sameSite:[],otherSites:[],count:0},this.showDelete=!1,this.loaded=!1}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){m.a.getRouteBooleanParam("openAddSite")&&this.add(),this.accountsList=yield s.a.getAccountsList(),this.loaded=!0,0!=this.accountsList.count||m.a.getRouteBooleanParam("openAddSite")||this.add()}))}add(){s.a.goToAddSite(!1,!0)}deleteSite(e,n){return Object(c.a)(this,void 0,void 0,(function*(){e.stopPropagation();let t=n.siteName||"";t=yield he.a.formatText(t,{clean:!0,singleLine:!0,filter:!1},[],n.id);try{yield p.a.showDeleteConfirm("core.login.confirmdeletesite",{sitename:t})}catch(e){return}try{yield s.a.deleteAccountFromList(this.accountsList,n),this.showDelete=!1,0==this.accountsList.count&&s.a.goToAddSite(!0,!0)}catch(e){p.a.showErrorModalDefault(e,"core.login.errordeletesite",!0)}}))}login(e,n){return Object(c.a)(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation();const t=yield p.a.showModalLoading();try{if(yield r.c.loadSite(n))return yield m.a.navigateToSiteHome(),void 0}catch(e){p.a.showErrorModalDefault(e,"Error loading site.")}finally{t.dismiss()}}))}toggleDelete(){this.showDelete=!this.showDelete}openSettings(){m.a.navigate("/settings")}}return CoreLoginSitesPage.ɵfac=function CoreLoginSitesPage_Factory(e){return new(e||CoreLoginSitesPage)},CoreLoginSitesPage.ɵcmp=g.sc({type:CoreLoginSitesPage,selectors:[["page-core-login-sites"]],decls:25,vars:18,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[1,"core-sitelist"],[4,"ngFor","ngForOf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"],["fill","clear",3,"click"],["slot","icon-only","name","fas-pen","aria-hidden","true"],["sticky","true","class","core-sitelist-sitename",4,"ngIf"],["button","","detail","true",3,"click",4,"ngFor","ngForOf"],["sticky","true",1,"core-sitelist-sitename"],["clean","true",3,"text","siteId"],["core-link","","autoLogin","no",3,"href"],["button","","detail","true",3,"click"],["slot","start",3,"user","linkProfile","siteId"],[1,"item-heading"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],["aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-trash","slot","icon-only","aria-hidden","true"]],template:function CoreLoginSitesPage_Template(e,n){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.Ec(6,"h1"),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Dc(),g.Ec(9,"ion-buttons",2),g.nd(10,CoreLoginSitesPage_ion_button_10_Template,3,3,"ion-button",3),g.Ec(11,"ion-button",4),g.Mc("click",(function CoreLoginSitesPage_Template_ion_button_click_11_listener(){return n.openSettings()})),g.Pc(12,"translate"),g.zc(13,"ion-icon",5),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(14,"ion-content",6),g.Ec(15,"core-loading",7),g.Ec(16,"ion-list",8),g.nd(17,CoreLoginSitesPage_ion_card_17_Template,3,2,"ion-card",9),g.Dc(),g.Dc(),g.Ec(18,"ion-fab",10),g.Ec(19,"ion-fab-button",4),g.Mc("click",(function CoreLoginSitesPage_Template_ion_fab_button_click_19_listener(){return n.add()})),g.Pc(20,"translate"),g.zc(21,"ion-icon",11),g.Ec(22,"span",12),g.pd(23),g.Pc(24,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,8,"core.back")),g.lc(4),g.qd(g.Qc(8,10,"core.login.accounts")),g.lc(3),g.Vc("ngIf",n.accountsList.count>0),g.lc(1),g.mc("aria-label",g.Qc(12,12,"core.settings.appsettings")),g.lc(4),g.Vc("hideUntil",n.loaded),g.lc(2),g.Vc("ngForOf",n.accountsList.otherSites),g.lc(2),g.mc("aria-label",g.Qc(20,14,"core.login.add")),g.lc(4),g.qd(g.Qc(24,16,"core.login.add")))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,O.t,M.a,C.l,C.D,N.a,b.a,C.v,T.a,C.P,O.s,C.x,Pe.a,C.y,C.n,C.J,C.O,G.a,k.a,C.I,Ce.a,C.k],pipes:[S.d],styles:["ion-list.core-sitelist[_ngcontent-%COMP%]   .core-sitelist-sitename[_ngcontent-%COMP%]{border-bottom:1px solid var(--stroke)}ion-list.core-sitelist[_ngcontent-%COMP%]   .core-sitelist-sitename[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}"],data:{animation:[fe.a.SLIDE_IN_OUT,fe.a.SHOW_HIDE]}}),CoreLoginSitesPage})();function CoreLoginChangePasswordPage_h1_6_Template(e,n){1&e&&(g.Ec(0,"h1"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.qd(g.Qc(2,1,"core.login.changepassword")))}function CoreLoginChangePasswordPage_h1_7_Template(e,n){1&e&&(g.Ec(0,"h1"),g.pd(1),g.Pc(2,"translate"),g.Dc()),2&e&&(g.lc(1),g.qd(g.Qc(2,1,"core.login.reconnecttosite")))}function CoreLoginChangePasswordPage_ng_container_14_Template(e,n){if(1&e){const e=g.Fc();g.Cc(0),g.Ec(1,"ion-item",7),g.Ec(2,"ion-label"),g.Ec(3,"h2"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-button",9),g.Mc("click",(function CoreLoginChangePasswordPage_ng_container_14_Template_ion_button_click_6_listener(){g.fd(e);return g.Oc().openChangePasswordPage()})),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Bc()}2&e&&(g.lc(4),g.qd(g.Qc(5,2,"core.login.forcepasswordchangenotice")),g.lc(3),g.rd(" ",g.Qc(8,4,"core.login.changepasswordbutton")," "))}function CoreLoginChangePasswordPage_ng_container_15_Template(e,n){if(1&e){const e=g.Fc();g.Cc(0),g.Ec(1,"ion-item",7),g.Ec(2,"ion-label"),g.Ec(3,"p"),g.pd(4),g.Pc(5,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(6,"ion-button",9),g.Mc("click",(function CoreLoginChangePasswordPage_ng_container_15_Template_ion_button_click_6_listener(){g.fd(e);return g.Oc().login()})),g.pd(7),g.Pc(8,"translate"),g.Dc(),g.Bc()}2&e&&(g.lc(4),g.qd(g.Qc(5,2,"core.login.changepasswordreconnectinstructions")),g.lc(3),g.rd(" ",g.Qc(8,4,"core.login.reconnect")," "))}let Oe=(()=>{class CoreLoginChangePasswordPage{constructor(){this.changingPassword=!1,this.logoutLabel=s.a.getLogoutLabel()}showHelp(){le.a.showHelp(l.I.instant("core.login.changepasswordhelp"),l.I.instant("core.login.changepasswordsupportsubject"))}openChangePasswordPage(){s.a.openInAppForEdit(r.c.getCurrentSiteId(),"/login/change_password.php",void 0,!0),this.changingPassword=!0,this.detectPasswordChanged()}login(){m.a.navigateToSiteHome(),this.changingPassword=!1}logout(){r.c.logout(),this.changingPassword=!1}detectPasswordChanged(){this.urlLoadedObserver||(this.urlLoadedObserver=w.b.on(w.b.IAB_LOAD_STOP,(e=>{var n;if(e.url.match(/\/login\/change_password\.php.*return=1/))return a.a.closeInAppBrowser(),this.login(),void 0;e.url.match(/\/login\/change_password\.php/)&&(null===(n=a.a.getInAppBrowserInstance())||void 0===n?void 0:n.executeScript({code:"\n                    if (\n                        document.querySelector('input[type=\"password\"]') === null &&\n                        document.querySelector('button[type=\"submit\"]') !== null\n                    ) {\n                        webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({ passwordChanged: true }));\n                    }\n                "}))})),this.messageObserver=w.b.on(w.b.IAB_MESSAGE,(e=>{e.passwordChanged&&(a.a.closeInAppBrowser(),this.login())})),this.browserClosedObserver=w.b.on(w.b.IAB_EXIT,(()=>{var e,n,t;null===(e=this.urlLoadedObserver)||void 0===e?void 0:e.off(),null===(n=this.messageObserver)||void 0===n||n.off(),null===(t=this.browserClosedObserver)||void 0===t||t.off(),delete this.urlLoadedObserver,delete this.messageObserver,delete this.browserClosedObserver})))}ngOnDestroy(){var e,n,t;null===(e=this.urlLoadedObserver)||void 0===e?void 0:e.off(),null===(n=this.messageObserver)||void 0===n||n.off(),null===(t=this.browserClosedObserver)||void 0===t||t.off()}}return CoreLoginChangePasswordPage.ɵfac=function CoreLoginChangePasswordPage_Factory(e){return new(e||CoreLoginChangePasswordPage)},CoreLoginChangePasswordPage.ɵcmp=g.sc({type:CoreLoginChangePasswordPage,selectors:[["page-core-login-change-password"]],decls:24,vars:16,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[1,"list-item-limited-width"],[1,"ion-text-wrap"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"]],template:function CoreLoginChangePasswordPage_Template(e,n){1&e&&(g.Ec(0,"ion-header"),g.Ec(1,"ion-toolbar"),g.Ec(2,"ion-buttons",0),g.zc(3,"ion-back-button",1),g.Pc(4,"translate"),g.Dc(),g.Ec(5,"ion-title"),g.nd(6,CoreLoginChangePasswordPage_h1_6_Template,3,3,"h1",2),g.nd(7,CoreLoginChangePasswordPage_h1_7_Template,3,3,"h1",2),g.Dc(),g.Ec(8,"ion-buttons",3),g.Ec(9,"ion-button",4),g.Mc("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_9_listener(){return n.showHelp()})),g.Pc(10,"translate"),g.zc(11,"ion-icon",5),g.Dc(),g.Dc(),g.Dc(),g.Dc(),g.Ec(12,"ion-content"),g.Ec(13,"ion-list",6),g.nd(14,CoreLoginChangePasswordPage_ng_container_14_Template,9,6,"ng-container",2),g.nd(15,CoreLoginChangePasswordPage_ng_container_15_Template,9,6,"ng-container",2),g.Ec(16,"ion-item",7),g.Ec(17,"ion-label"),g.Ec(18,"p"),g.pd(19),g.Pc(20,"translate"),g.Dc(),g.Dc(),g.Dc(),g.Ec(21,"ion-button",8),g.Mc("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_21_listener(){return n.logout()})),g.pd(22),g.Pc(23,"translate"),g.Dc(),g.Dc(),g.Dc()),2&e&&(g.lc(3),g.Vc("text",g.Qc(4,8,"core.back")),g.lc(3),g.Vc("ngIf",!n.changingPassword),g.lc(1),g.Vc("ngIf",n.changingPassword),g.lc(2),g.mc("aria-label",g.Qc(10,10,"core.help")),g.lc(5),g.Vc("ngIf",!n.changingPassword),g.lc(1),g.Vc("ngIf",n.changingPassword),g.lc(4),g.qd(g.Qc(20,12,"core.wanttochangesite")),g.lc(3),g.rd(" ",g.Qc(23,14,n.logoutLabel)," "))},directives:[C.C,C.Ab,C.m,C.h,C.i,C.yb,O.t,M.a,C.l,C.D,N.a,b.a,C.v,C.P,C.I,C.O],pipes:[S.d],encapsulation:2}),CoreLoginChangePasswordPage})();const Ee=[{path:"",pathMatch:"full",redirectTo:"sites"},{path:"site",component:me},{path:"credentials",loadChildren:()=>s.a.getCredentialsRouteModule()},{path:"sites",component:be,canLoad:[d],canActivate:[d]},{path:"forgottenpassword",component:D},{path:"changepassword",component:Oe},{path:"sitepolicy",component:F},{path:"emailsignup",component:K},{path:"reconnect",loadChildren:()=>s.a.getReconnectRouteModule()}];let Me=(()=>{class CoreLoginLazyModule{}return CoreLoginLazyModule.ɵmod=g.wc({type:CoreLoginLazyModule}),CoreLoginLazyModule.ɵinj=g.vc({factory:function CoreLoginLazyModule_Factory(e){return new(e||CoreLoginLazyModule)},imports:[[i.a,_.a,V.a,o.m.forChild(Ee)]]}),CoreLoginLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&g.kd(Me,{declarations:[D,F,me,be,Oe,K],imports:[i.a,_.a,V.a,o.m]}))}}]);