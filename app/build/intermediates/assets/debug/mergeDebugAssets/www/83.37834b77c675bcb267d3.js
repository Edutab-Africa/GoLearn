(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{BkwX:function(e,r,t){"use strict";t.r(r),t.d(r,"CoreSearchGlobalSearchFiltersComponent",(function(){return b})),t.d(r,"CoreSearchGlobalSearchFiltersComponentModule",(function(){return F}));var o=t("L3Fv"),n=t("mrSG"),c=t("Xzvb"),a=t("9CLO"),i=t("fjkH"),l=t("j3ag"),s=t("bFG1"),h=t("fXoL"),d=t("TEn/"),C=t("ACYt"),u=t("3CSS"),_=t("nt/U"),g=t("ofXK"),p=t("nEkO"),m=t("3Pt+"),S=t("hMzs"),f=t("sYmb");function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template(e,r){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",8),h.Ec(1,"ion-label"),h.zc(2,"core-format-text",11),h.Dc(),h.Ec(3,"ion-checkbox",12),h.Mc("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template_ion_checkbox_ngModelChange_3_listener(t){h.fd(e);return r.$implicit.checked=t}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template_ion_checkbox_ionChange_3_listener(){h.fd(e);const t=r.$implicit;return h.Oc(2).onSearchAreaCategoryInputChanged(t)})),h.Dc(),h.Dc()}if(2&e){const e=r.$implicit;h.lc(2),h.Vc("text",e.name),h.lc(1),h.Vc("ngModel",e.checked)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template(e,r){if(1&e){const e=h.Fc();h.Cc(0),h.zc(1,"core-spacer"),h.Ec(2,"ion-item",7),h.Ec(3,"ion-label"),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Ec(6,"ion-item",8),h.Ec(7,"ion-label"),h.pd(8),h.Pc(9,"translate"),h.Dc(),h.Ec(10,"ion-checkbox",9),h.Mc("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template_ion_checkbox_ngModelChange_10_listener(r){h.fd(e);return h.Oc().allSearchAreaCategories=r}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template_ion_checkbox_ionChange_10_listener(){h.fd(e);return h.Oc().allSearchAreaCategoriesUpdated()})),h.Dc(),h.Dc(),h.nd(11,CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_11_Template,4,2,"ion-item",10),h.Bc()}if(2&e){const e=h.Oc();h.lc(4),h.rd(" ",h.Qc(5,5,"core.search.filtercategories")," "),h.lc(4),h.qd(h.Qc(9,7,"core.search.allcategories")),h.lc(2),h.Vc("ngModel",e.allSearchAreaCategories)("indeterminate",null===e.allSearchAreaCategories),h.lc(1),h.Vc("ngForOf",e.searchAreaCategories)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template(e,r){if(1&e){const e=h.Fc();h.Ec(0,"ion-item",8),h.Ec(1,"ion-label"),h.zc(2,"core-format-text",11),h.Dc(),h.Ec(3,"ion-checkbox",12),h.Mc("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template_ion_checkbox_ngModelChange_3_listener(t){h.fd(e);return r.$implicit.checked=t}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template_ion_checkbox_ionChange_3_listener(){h.fd(e);const t=r.$implicit;return h.Oc(2).onCourseInputChanged(t)})),h.Dc(),h.Dc()}if(2&e){const e=r.$implicit;h.lc(2),h.Vc("text",e.shortname),h.lc(1),h.Vc("ngModel",e.checked)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template(e,r){if(1&e){const e=h.Fc();h.Cc(0),h.zc(1,"core-spacer"),h.Ec(2,"ion-item",7),h.Ec(3,"ion-label"),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Ec(6,"ion-item",8),h.Ec(7,"ion-label"),h.pd(8),h.Pc(9,"translate"),h.Dc(),h.Ec(10,"ion-checkbox",9),h.Mc("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template_ion_checkbox_ngModelChange_10_listener(r){h.fd(e);return h.Oc().allCourses=r}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template_ion_checkbox_ionChange_10_listener(){h.fd(e);return h.Oc().allCoursesUpdated()})),h.Dc(),h.Dc(),h.nd(11,CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_11_Template,4,2,"ion-item",10),h.Bc()}if(2&e){const e=h.Oc();h.lc(4),h.rd(" ",h.Qc(5,5,"core.search.filtercourses")," "),h.lc(4),h.qd(h.Qc(9,7,"core.search.allcourses")),h.lc(2),h.Vc("ngModel",e.allCourses)("indeterminate",null===e.allCourses),h.lc(1),h.Vc("ngForOf",e.courses)}}let b=(()=>{class CoreSearchGlobalSearchFiltersComponent{constructor(){this.allSearchAreaCategories=!0,this.searchAreaCategories=[],this.allCourses=!0,this.courses=[],this.newFilters={}}ngOnInit(){var e;return Object(n.a)(this,void 0,void 0,(function*(){this.newFilters=null!==(e=this.filters)&&void 0!==e?e:{},yield this.updateSearchAreaCategories(),yield this.updateCourses()}))}close(){l.w.dismiss()}allSearchAreaCategoriesUpdated(){if(null===this.allSearchAreaCategories)return;const e=this.allSearchAreaCategories;this.searchAreaCategories.forEach((r=>{r.checked!==e&&(r.checked=e)}))}onSearchAreaCategoryInputChanged(e){(e.checked||!this.newFilters.searchAreaCategoryIds||this.newFilters.searchAreaCategoryIds.includes(e.id))&&(!e.checked||this.newFilters.searchAreaCategoryIds&&!this.newFilters.searchAreaCategoryIds.includes(e.id))&&this.searchAreaCategoryUpdated()}allCoursesUpdated(){if(null===this.allCourses)return;const e=this.allCourses;this.courses.forEach((r=>{r.checked!==e&&(r.checked=e)}))}onCourseInputChanged(e){(e.checked||!this.newFilters.courseIds||this.newFilters.courseIds.includes(e.id))&&(!e.checked||this.newFilters.courseIds&&!this.newFilters.courseIds.includes(e.id))&&this.courseUpdated()}refreshFilters(e){return Object(n.a)(this,void 0,void 0,(function*(){yield s.a.ignoreErrors(Promise.all([a.c.invalidateSearchAreas(),c.a.invalidateUserCourses()])),yield this.updateSearchAreaCategories(),yield this.updateCourses(),null==e||e.complete()}))}updateSearchAreaCategories(){var e,r,t;return Object(n.a)(this,void 0,void 0,(function*(){const o=yield a.c.getSearchAreas(),n=new Set;this.searchAreaCategories=[];for(const c of o)n.has(c.category.id)||(n.add(c.category.id),this.searchAreaCategories.push(Object.assign(Object.assign({},c.category),{checked:null===(t=null===(r=null===(e=this.filters)||void 0===e?void 0:e.searchAreaCategoryIds)||void 0===r?void 0:r.includes(c.category.id))||void 0===t||t})));this.allSearchAreaCategories=this.getGroupFilterStatus(this.searchAreaCategories)}))}updateCourses(){return Object(n.a)(this,void 0,void 0,(function*(){const e=yield c.a.getUserCourses();this.courses=e.sort(((e,r)=>{var t,o,n,c;return(null!==(o=null===(t=e.shortname)||void 0===t?void 0:t.toLowerCase())&&void 0!==o?o:"").localeCompare(null!==(c=null===(n=r.shortname)||void 0===n?void 0:n.toLowerCase())&&void 0!==c?c:"")})).map((e=>{var r,t,o;return Object.assign(Object.assign({},e),{checked:null===(o=null===(t=null===(r=this.filters)||void 0===r?void 0:r.courseIds)||void 0===t?void 0:t.includes(e.id))||void 0===o||o})})),this.allCourses=this.getGroupFilterStatus(this.courses)}))}searchAreaCategoryUpdated(){const e=this.getGroupFilterStatus(this.searchAreaCategories);e!==this.allSearchAreaCategories&&(this.allSearchAreaCategories=e),this.emitFiltersUpdated()}courseUpdated(){const e=this.getGroupFilterStatus(this.courses);e!==this.allCourses&&(this.allCourses=e),this.emitFiltersUpdated()}getGroupFilterStatus(e){if(0===e.length)return null;const r=e[0].checked;for(const t of e)if(t.checked!==r)return null;return r}emitFiltersUpdated(){this.newFilters={},this.allSearchAreaCategories||(this.newFilters.searchAreaCategoryIds=this.searchAreaCategories.filter((({checked:e})=>e)).map((({id:e})=>e))),this.allCourses||(this.newFilters.courseIds=this.courses.filter((({checked:e})=>e)).map((({id:e})=>e))),i.b.trigger(a.a,this.newFilters)}}return CoreSearchGlobalSearchFiltersComponent.ɵfac=function CoreSearchGlobalSearchFiltersComponent_Factory(e){return new(e||CoreSearchGlobalSearchFiltersComponent)},CoreSearchGlobalSearchFiltersComponent.ɵcmp=h.sc({type:CoreSearchGlobalSearchFiltersComponent,selectors:[["core-search-global-search-filters"]],inputs:{hideCourses:"hideCourses",filters:"filters"},decls:17,vars:12,consts:[["slot","end"],["fill","clear",3,"click"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[3,"pullingText"],[4,"ngIf"],[1,"ion-text-wrap","help"],[1,"ion-text-wrap"],["slot","end",3,"ngModel","indeterminate","ngModelChange","ionChange"],["class","ion-text-wrap",4,"ngFor","ngForOf"],[3,"text"],["slot","end",3,"ngModel","ngModelChange","ionChange"]],template:function CoreSearchGlobalSearchFiltersComponent_Template(e,r){1&e&&(h.Ec(0,"ion-header"),h.Ec(1,"ion-toolbar"),h.Ec(2,"ion-title"),h.Ec(3,"h1"),h.pd(4),h.Pc(5,"translate"),h.Dc(),h.Dc(),h.Ec(6,"ion-buttons",0),h.Ec(7,"ion-button",1),h.Mc("click",(function CoreSearchGlobalSearchFiltersComponent_Template_ion_button_click_7_listener(){return r.close()})),h.Pc(8,"translate"),h.zc(9,"ion-icon",2),h.Dc(),h.Dc(),h.Dc(),h.Dc(),h.Ec(10,"ion-content",3),h.Ec(11,"ion-refresher",4),h.Mc("ionRefresh",(function CoreSearchGlobalSearchFiltersComponent_Template_ion_refresher_ionRefresh_11_listener(e){return r.refreshFilters(e.target)})),h.zc(12,"ion-refresher-content",5),h.Pc(13,"translate"),h.Dc(),h.Ec(14,"ion-list"),h.nd(15,CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template,12,9,"ng-container",6),h.nd(16,CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template,12,9,"ng-container",6),h.Dc(),h.Dc()),2&e&&(h.lc(4),h.qd(h.Qc(5,6,"core.search.filterheader")),h.lc(3),h.mc("aria-label",h.Qc(8,8,"core.close")),h.lc(3),h.Vc("fullscreen",!0),h.lc(2),h.Wc("pullingText",h.Qc(13,10,"core.pulltorefresh")),h.lc(3),h.Vc("ngIf",r.searchAreaCategories.length>0),h.lc(1),h.Vc("ngIf",!r.hideCourses&&r.courses.length>0))},directives:[d.C,d.Ab,d.yb,d.m,C.a,d.l,d.D,u.a,_.a,d.v,d.bb,d.cb,d.P,g.t,p.a,d.I,d.O,d.s,d.d,m.r,m.u,g.s,S.a],pipes:[f.d],styles:["[_nghost-%COMP%]{--help-text-color:var(--gray-700)}[_nghost-%COMP%]   ion-item.help[_ngcontent-%COMP%]{color:var(--help-text-color)}[_nghost-%COMP%]   ion-item.help[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]:not(.help){font-size:16px}html.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%]{--help-text-color:var(--gray-400)}"]}),CoreSearchGlobalSearchFiltersComponent})(),F=(()=>{class CoreSearchGlobalSearchFiltersComponentModule{}return CoreSearchGlobalSearchFiltersComponentModule.ɵmod=h.wc({type:CoreSearchGlobalSearchFiltersComponentModule}),CoreSearchGlobalSearchFiltersComponentModule.ɵinj=h.vc({factory:function CoreSearchGlobalSearchFiltersComponentModule_Factory(e){return new(e||CoreSearchGlobalSearchFiltersComponentModule)},imports:[[o.a]]}),CoreSearchGlobalSearchFiltersComponentModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kd(F,{declarations:[b],imports:[o.a]}))}}]);